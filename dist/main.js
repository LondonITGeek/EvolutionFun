!function(n){var c={};function t(e){if(c[e])return c[e].exports;var r=c[e]={i:e,l:!1,exports:{}};return n[e].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=n,t.c=c,t.d=function(n,c,e){t.o(n,c)||Object.defineProperty(n,c,{enumerable:!0,get:e})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,c){if(1&c&&(n=t(n)),8&c)return n;if(4&c&&"object"==typeof n&&n&&n.__esModule)return n;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:n}),2&c&&"string"!=typeof n)for(var r in n)t.d(e,r,function(c){return n[c]}.bind(null,r));return e},t.n=function(n){var c=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(c,"a",c),c},t.o=function(n,c){return Object.prototype.hasOwnProperty.call(n,c)},t.p="",t(t.s=0)}([function(module,exports,__webpack_require__){eval("const { default: Simulation } = __webpack_require__(3);\r\nconst { default: SuccessCriteria } = __webpack_require__(1);\r\nconst { SuccessCriteriaVisualization } = __webpack_require__(2);\r\n\r\nvar successCriteriaVisualization = new SuccessCriteriaVisualization(SuccessCriteria.allCornersSuccess());\r\nvar simulation = new Simulation(500, 100, 300, 40, 6, 3, 0.0001, successCriteriaVisualization);\r\nsimulation.start();\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanM/YjYzNSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLHNCQUFzQixHQUFHLG1CQUFPLENBQUMsQ0FBYztBQUN0RCxPQUFPLDJCQUEyQixHQUFHLG1CQUFPLENBQUMsQ0FBb0I7QUFDakUsT0FBTywrQkFBK0IsR0FBRyxtQkFBTyxDQUFDLENBQWtDOztBQUVuRjtBQUNBO0FBQ0EiLCJmaWxlIjoiMC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgZGVmYXVsdDogU2ltdWxhdGlvbiB9ID0gcmVxdWlyZShcIi4vc2ltdWxhdGlvblwiKTtcclxuY29uc3QgeyBkZWZhdWx0OiBTdWNjZXNzQ3JpdGVyaWEgfSA9IHJlcXVpcmUoXCIuL3N1Y2Nlc3MtY3JpdGVyaWFcIik7XHJcbmNvbnN0IHsgU3VjY2Vzc0NyaXRlcmlhVmlzdWFsaXphdGlvbiB9ID0gcmVxdWlyZShcIi4vc3VjY2Vzcy1jcml0ZXJpYS12aXN1YWxpemF0aW9uXCIpO1xyXG5cclxudmFyIHN1Y2Nlc3NDcml0ZXJpYVZpc3VhbGl6YXRpb24gPSBuZXcgU3VjY2Vzc0NyaXRlcmlhVmlzdWFsaXphdGlvbihTdWNjZXNzQ3JpdGVyaWEuYWxsQ29ybmVyc1N1Y2Nlc3MoKSk7XHJcbnZhciBzaW11bGF0aW9uID0gbmV3IFNpbXVsYXRpb24oNTAwLCAxMDAsIDMwMCwgNDAsIDYsIDMsIDAuMDAwMSwgc3VjY2Vzc0NyaXRlcmlhVmlzdWFsaXphdGlvbik7XHJcbnNpbXVsYXRpb24uc3RhcnQoKTtcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///0\n")},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return SuccessCriteria; });\nclass SuccessCriteria {\r\n  static topRightCornerSuccess() {\r\n    return [\r\n      {\r\n        borderColour: "green",\r\n        x: 440,\r\n        y: 0,\r\n        width: 200,\r\n        height: 200,\r\n      },\r\n    ];\r\n  }\r\n\r\n  static topLeftCornerSuccess() {\r\n    return [\r\n      {\r\n        borderColour: "green",\r\n        x: 0,\r\n        y: 0,\r\n        width: 200,\r\n        height: 200,\r\n      },\r\n    ];\r\n  }\r\n\r\n  static bottomRightCornerSuccess() {\r\n    return [\r\n      {\r\n        borderColour: "green",\r\n        x: 440,\r\n        y: 440,\r\n        width: 200,\r\n        height: 200,\r\n      },\r\n    ];\r\n  }\r\n\r\n  static bottomLeftCornerSuccess() {\r\n    return [\r\n      {\r\n        borderColour: "green",\r\n        x: 0,\r\n        y: 440,\r\n        width: 200,\r\n        height: 200,\r\n      },\r\n    ];\r\n  }\r\n\r\n  static rightWallSuccess() {\r\n    return [\r\n      {\r\n        borderColour: "green",\r\n        x: 540,\r\n        y: 0,\r\n        width: 100,\r\n        height: 640,\r\n      },\r\n    ];\r\n  }\r\n\r\n  static leftWallSuccess() {\r\n    return [\r\n      {\r\n        borderColour: "green",\r\n        x: 0,\r\n        y: 0,\r\n        width: 100,\r\n        height: 640,\r\n      },\r\n    ];\r\n  }\r\n\r\n  static allCornersSuccess() {\r\n    return [\r\n      ...this.topLeftCornerSuccess(),\r\n      ...this.topRightCornerSuccess(),\r\n      ...this.bottomLeftCornerSuccess(),\r\n      ...this.bottomRightCornerSuccess(),\r\n    ];\r\n  }\r\n\r\n  static rightAndLeftWallSuccess() {\r\n    return [...SuccessCriteria.rightWallSuccess(), ...SuccessCriteria.leftWallSuccess()];\r\n  }\r\n\r\n  static topWallSuccess() {\r\n    return [\r\n      {\r\n        borderColour: "green",\r\n        x: 0,\r\n        y: 0,\r\n        width: 640,\r\n        height: 100,\r\n      },\r\n    ];\r\n  }\r\n\r\n  static topAndBottomWallSuccess() {\r\n    return [\r\n      ...SuccessCriteria.topWallSuccess(),\r\n      {\r\n        borderColour: "green",\r\n        x: 0,\r\n        y: 540,\r\n        width: 640,\r\n        height: 100,\r\n      },\r\n    ];\r\n  }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvc3VjY2Vzcy1jcml0ZXJpYS5qcz85MTU3Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQUE7QUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBIiwiZmlsZSI6IjEuanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBTdWNjZXNzQ3JpdGVyaWEge1xyXG4gIHN0YXRpYyB0b3BSaWdodENvcm5lclN1Y2Nlc3MoKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICB7XHJcbiAgICAgICAgYm9yZGVyQ29sb3VyOiBcImdyZWVuXCIsXHJcbiAgICAgICAgeDogNDQwLFxyXG4gICAgICAgIHk6IDAsXHJcbiAgICAgICAgd2lkdGg6IDIwMCxcclxuICAgICAgICBoZWlnaHQ6IDIwMCxcclxuICAgICAgfSxcclxuICAgIF07XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgdG9wTGVmdENvcm5lclN1Y2Nlc3MoKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICB7XHJcbiAgICAgICAgYm9yZGVyQ29sb3VyOiBcImdyZWVuXCIsXHJcbiAgICAgICAgeDogMCxcclxuICAgICAgICB5OiAwLFxyXG4gICAgICAgIHdpZHRoOiAyMDAsXHJcbiAgICAgICAgaGVpZ2h0OiAyMDAsXHJcbiAgICAgIH0sXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGJvdHRvbVJpZ2h0Q29ybmVyU3VjY2VzcygpIHtcclxuICAgIHJldHVybiBbXHJcbiAgICAgIHtcclxuICAgICAgICBib3JkZXJDb2xvdXI6IFwiZ3JlZW5cIixcclxuICAgICAgICB4OiA0NDAsXHJcbiAgICAgICAgeTogNDQwLFxyXG4gICAgICAgIHdpZHRoOiAyMDAsXHJcbiAgICAgICAgaGVpZ2h0OiAyMDAsXHJcbiAgICAgIH0sXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIGJvdHRvbUxlZnRDb3JuZXJTdWNjZXNzKCkge1xyXG4gICAgcmV0dXJuIFtcclxuICAgICAge1xyXG4gICAgICAgIGJvcmRlckNvbG91cjogXCJncmVlblwiLFxyXG4gICAgICAgIHg6IDAsXHJcbiAgICAgICAgeTogNDQwLFxyXG4gICAgICAgIHdpZHRoOiAyMDAsXHJcbiAgICAgICAgaGVpZ2h0OiAyMDAsXHJcbiAgICAgIH0sXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgc3RhdGljIHJpZ2h0V2FsbFN1Y2Nlc3MoKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICB7XHJcbiAgICAgICAgYm9yZGVyQ29sb3VyOiBcImdyZWVuXCIsXHJcbiAgICAgICAgeDogNTQwLFxyXG4gICAgICAgIHk6IDAsXHJcbiAgICAgICAgd2lkdGg6IDEwMCxcclxuICAgICAgICBoZWlnaHQ6IDY0MCxcclxuICAgICAgfSxcclxuICAgIF07XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgbGVmdFdhbGxTdWNjZXNzKCkge1xyXG4gICAgcmV0dXJuIFtcclxuICAgICAge1xyXG4gICAgICAgIGJvcmRlckNvbG91cjogXCJncmVlblwiLFxyXG4gICAgICAgIHg6IDAsXHJcbiAgICAgICAgeTogMCxcclxuICAgICAgICB3aWR0aDogMTAwLFxyXG4gICAgICAgIGhlaWdodDogNjQwLFxyXG4gICAgICB9LFxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBhbGxDb3JuZXJzU3VjY2VzcygpIHtcclxuICAgIHJldHVybiBbXHJcbiAgICAgIC4uLnRoaXMudG9wTGVmdENvcm5lclN1Y2Nlc3MoKSxcclxuICAgICAgLi4udGhpcy50b3BSaWdodENvcm5lclN1Y2Nlc3MoKSxcclxuICAgICAgLi4udGhpcy5ib3R0b21MZWZ0Q29ybmVyU3VjY2VzcygpLFxyXG4gICAgICAuLi50aGlzLmJvdHRvbVJpZ2h0Q29ybmVyU3VjY2VzcygpLFxyXG4gICAgXTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyByaWdodEFuZExlZnRXYWxsU3VjY2VzcygpIHtcclxuICAgIHJldHVybiBbLi4uU3VjY2Vzc0NyaXRlcmlhLnJpZ2h0V2FsbFN1Y2Nlc3MoKSwgLi4uU3VjY2Vzc0NyaXRlcmlhLmxlZnRXYWxsU3VjY2VzcygpXTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyB0b3BXYWxsU3VjY2VzcygpIHtcclxuICAgIHJldHVybiBbXHJcbiAgICAgIHtcclxuICAgICAgICBib3JkZXJDb2xvdXI6IFwiZ3JlZW5cIixcclxuICAgICAgICB4OiAwLFxyXG4gICAgICAgIHk6IDAsXHJcbiAgICAgICAgd2lkdGg6IDY0MCxcclxuICAgICAgICBoZWlnaHQ6IDEwMCxcclxuICAgICAgfSxcclxuICAgIF07XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgdG9wQW5kQm90dG9tV2FsbFN1Y2Nlc3MoKSB7XHJcbiAgICByZXR1cm4gW1xyXG4gICAgICAuLi5TdWNjZXNzQ3JpdGVyaWEudG9wV2FsbFN1Y2Nlc3MoKSxcclxuICAgICAge1xyXG4gICAgICAgIGJvcmRlckNvbG91cjogXCJncmVlblwiLFxyXG4gICAgICAgIHg6IDAsXHJcbiAgICAgICAgeTogNTQwLFxyXG4gICAgICAgIHdpZHRoOiA2NDAsXHJcbiAgICAgICAgaGVpZ2h0OiAxMDAsXHJcbiAgICAgIH0sXHJcbiAgICBdO1xyXG4gIH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///1\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "SuccessCriteriaVisualization", function() { return SuccessCriteriaVisualization; });\nclass SuccessCriteriaVisualization {\r\n  constructor(successCriteria) {\r\n    this.successCriteria = successCriteria;\r\n  }\r\n\r\n  drawer(ctx) {\r\n    this.successCriteria.forEach((criteria) => {\r\n      ctx.lineWidth = 3;\r\n      ctx.strokeStyle = criteria.borderColour;\r\n      ctx.beginPath();\r\n      ctx.rect(criteria.x, criteria.y, criteria.width, criteria.height);\r\n      ctx.stroke();\r\n    });\r\n  }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvc3VjY2Vzcy1jcml0ZXJpYS12aXN1YWxpemF0aW9uLmpzP2Y1ZDkiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFBQTtBQUFPO0FBQ1A7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EiLCJmaWxlIjoiMi5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBTdWNjZXNzQ3JpdGVyaWFWaXN1YWxpemF0aW9uIHtcclxuICBjb25zdHJ1Y3RvcihzdWNjZXNzQ3JpdGVyaWEpIHtcclxuICAgIHRoaXMuc3VjY2Vzc0NyaXRlcmlhID0gc3VjY2Vzc0NyaXRlcmlhO1xyXG4gIH1cclxuXHJcbiAgZHJhd2VyKGN0eCkge1xyXG4gICAgdGhpcy5zdWNjZXNzQ3JpdGVyaWEuZm9yRWFjaCgoY3JpdGVyaWEpID0+IHtcclxuICAgICAgY3R4LmxpbmVXaWR0aCA9IDM7XHJcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IGNyaXRlcmlhLmJvcmRlckNvbG91cjtcclxuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICBjdHgucmVjdChjcml0ZXJpYS54LCBjcml0ZXJpYS55LCBjcml0ZXJpYS53aWR0aCwgY3JpdGVyaWEuaGVpZ2h0KTtcclxuICAgICAgY3R4LnN0cm9rZSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///2\n')},function(module,__webpack_exports__,__webpack_require__){"use strict";eval('__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./src/creature.js\nclass Creature {\r\n  constructor(genome, neuralNetwork, startingX, startingY, dimension, gameWidth, gameHeight, speed, drawInfo) {\r\n    this.genome = genome;\r\n    this.neuralNetwork = neuralNetwork;\r\n    this.gameWidth = gameWidth;\r\n    this.gameHeight = gameHeight;\r\n    this.speed = speed;\r\n    this.drawInfo = drawInfo;\r\n    this.dimensions = {\r\n      width: dimension,\r\n      height: dimension,\r\n    };\r\n\r\n    this.position = {\r\n      x: startingX,\r\n      y: startingY,\r\n    };\r\n\r\n    this.generateColour();\r\n  }\r\n\r\n  scaleValue(value, xMin, xMax, yMin, yMax) {\r\n    var percent = (value - yMin) / (yMax - yMin);\r\n    return percent * (xMax - xMin) + xMin;\r\n  }\r\n\r\n  getRandomColour(scaledGenomeNumber) {\r\n    return `#${Math.floor(scaledGenomeNumber * 16777215).toString(16)}`;\r\n  }\r\n\r\n  generateColour() {\r\n    var genomeColour =\r\n      this.genome.chromosomes.reduce((lastValue, currentValue) => {\r\n        lastValue ^= currentValue;\r\n        return lastValue >>> 0;\r\n      }, this.genome.chromosomes[0]) >>> 0;\r\n\r\n    var scaledGenomeColour = this.scaleValue(genomeColour, 0, 1, 0, 4294967295); // Max value of unsigned 32 bit int... 4294967295\r\n    this.colour = this.getRandomColour(scaledGenomeColour);\r\n  }\r\n\r\n  drawerLable(ctx) {\r\n    ctx.fillText(`${this.genome.toString()}`, this.position.x - 10, this.position.y - 10);\r\n  }\r\n\r\n  drawer(ctx) {\r\n    ctx.fillStyle = this.colour;\r\n    ctx.beginPath();\r\n    ctx.ellipse(\r\n      this.position.x + this.dimensions.width / 2,\r\n      this.position.y + this.dimensions.height / 2,\r\n      this.dimensions.width / 2,\r\n      this.dimensions.height / 2,\r\n      0,\r\n      0,\r\n      2 * Math.PI\r\n    );\r\n    ctx.fill();\r\n    ctx.closePath();\r\n    if (this.drawInfo) {\r\n      this.drawerLable(ctx);\r\n    }\r\n  }\r\n\r\n  update(actionProbabilities) {\r\n    const currentPosition = {\r\n      ...this.position,\r\n    };\r\n\r\n    if (actionProbabilities.length > 0) {\r\n      var currentProbabilityRoll = Math.random();\r\n      var bestAction = actionProbabilities.sort((a, b) => b - a)[0];\r\n      //console.log(bestAction.getValue());\r\n\r\n      if (currentProbabilityRoll < bestAction.getValue()) {\r\n        bestAction.applyAction(this);\r\n      }\r\n      if (\r\n        this.position.x < 0 ||\r\n        this.position.x >= this.gameWidth * this.dimensions.width ||\r\n        this.position.y < 0 ||\r\n        this.position.y >= this.gameHeight * this.dimensions.height\r\n      ) {\r\n        //console.log("Hit Edge");\r\n        this.position = currentPosition;\r\n      }\r\n    }\r\n  }\r\n\r\n  updateAndRedrawer(ctx) {\r\n    var actionProbabilities = this.neuralNetwork.feedForward(this);\r\n    this.update(actionProbabilities);\r\n    this.drawer(ctx);\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/game.js\nclass Game {\r\n  constructor(GAME_HEIGHT, GAME_WIDTH, DIVISION_SIZE, SHOW_GRAPH, successCriteria) {\r\n    this.height = GAME_HEIGHT;\r\n    this.width = GAME_WIDTH;\r\n    this.divisionSize = DIVISION_SIZE;\r\n    this.showGraph = SHOW_GRAPH;\r\n    this.successCriteria = successCriteria;\r\n    this.gameCreatures = [];\r\n\r\n    this.canvas = document.createElement("canvas");\r\n    this.canvas.setAttribute("id", "canvas");\r\n    this.canvas.setAttribute("width", GAME_WIDTH * DIVISION_SIZE);\r\n    this.canvas.setAttribute("height", GAME_HEIGHT * DIVISION_SIZE);\r\n    this.canvas.setAttribute("style", "border: 1px solid black; box-sizing: border-box");\r\n    document.body.appendChild(this.canvas);\r\n    this.ctx = canvas.getContext("2d");\r\n  }\r\n\r\n  addCreature(creature) {\r\n    this.gameCreatures.push(creature);\r\n  }\r\n\r\n  getSurvivors(successCriteria) {\r\n    return this.gameCreatures.filter((c) => {\r\n      return successCriteria.some((criteria) => {\r\n        const xBottom = criteria.x + criteria.width;\r\n        const yBottom = criteria.y + criteria.height;\r\n        return c.position.x >= criteria.x && c.position.y >= criteria.y && c.position.x <= xBottom && c.position.y <= yBottom;\r\n      });\r\n    });\r\n  }\r\n\r\n  drawGrid() {\r\n    this.ctx.lineWidth = 0.5;\r\n    // Do columns\r\n    for (let index = this.divisionSize; index < this.width * this.divisionSize; index += this.divisionSize) {\r\n      this.ctx.beginPath();\r\n      this.ctx.moveTo(index, 0);\r\n      this.ctx.lineTo(index, this.height * this.divisionSize);\r\n      this.ctx.stroke();\r\n      this.ctx.closePath();\r\n    }\r\n\r\n    // Do Rows\r\n    for (let index = this.divisionSize; index < this.height * this.divisionSize; index += this.divisionSize) {\r\n      this.ctx.beginPath();\r\n      this.ctx.moveTo(0, index);\r\n      this.ctx.lineTo(this.width * this.divisionSize, index);\r\n      this.ctx.stroke();\r\n      this.ctx.closePath();\r\n    }\r\n  }\r\n\r\n  update() {\r\n    this.ctx.fillStyle = "white";\r\n    this.ctx.fillRect(0, 0, this.width * this.divisionSize, this.height * this.divisionSize);\r\n    this.gameCreatures.forEach((creature) => {\r\n      creature.updateAndRedrawer(this.ctx);\r\n    });\r\n\r\n    if (this.showGraph) {\r\n      this.drawGrid();\r\n    }\r\n\r\n    this.successCriteria.drawer(this.ctx);\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/genome.js\nclass Genome {\r\n  constructor(size, generateRandomValues = true) {\r\n    if (size % 2 !== 0) {\r\n      throw "Genome size must be an even number.";\r\n    }\r\n    this.size = size;\r\n    this.chromosomes = new Uint32Array(size);\r\n    if (generateRandomValues) {\r\n      window.crypto.getRandomValues(this.chromosomes);\r\n    }\r\n  }\r\n\r\n  static createNewGenomeFromParents(genomeOne, genomeTwo) {\r\n    var takeFromParentOneFirst = Math.random() > 0.5;\r\n    var size = genomeOne.size;\r\n    var newGenome = new Genome(size, false);\r\n    for (let index = 0; index < size; index++) {\r\n      if (takeFromParentOneFirst) {\r\n        newGenome.chromosomes[index] = genomeOne.chromosomes[index];\r\n      } else {\r\n        newGenome.chromosomes[index] = genomeTwo.chromosomes[index];\r\n      }\r\n\r\n      takeFromParentOneFirst = !takeFromParentOneFirst;\r\n    }\r\n\r\n    return newGenome;\r\n  }\r\n\r\n  toString() {\r\n    return this.chromosomes.join(":");\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/neuron.js\nclass Neuron {\r\n  constructor(type, game) {\r\n    this.type = type;\r\n    this.game = game;\r\n    this.connections = [];\r\n    this.lastValue = 0;\r\n  }\r\n\r\n  scaleValue(value, xMin, xMax, yMin, yMax) {\r\n    var percent = (value - yMin) / (yMax - yMin);\r\n    return percent * (xMax - xMin) + xMin;\r\n  }\r\n\r\n  addConnection(connection) {\r\n    this.connections.push(connection);\r\n  }\r\n\r\n  updateLastValue(lastValue) {\r\n    this.lastValue = lastValue;\r\n  }\r\n\r\n  getValue(creature) {\r\n    return this.lastValue;\r\n  }\r\n\r\n  applyAction(creature) {\r\n    return;\r\n  }\r\n\r\n  toString() {\r\n    return `${this.type}`;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/inputs/SensitivityToProximityToEast.js\n\r\n\r\nclass SensitivityToProximityToEast_SensitivityToProximityToEast extends Neuron {\r\n  constructor(game) {\r\n    super("SensitivityToProximityToEast", game);\r\n  }\r\n\r\n  getValue(creature) {\r\n    var scaledGameWidth = this.game.width * this.game.divisionSize;\r\n    var scaledInput = this.scaleValue(creature.position.x, 0, 1, 0, scaledGameWidth);\r\n    return scaledInput;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/inputs/SensitivityToProximityToWest.js\n\r\n\r\nclass SensitivityToProximityToWest_SensitivityToProximityToWest extends Neuron {\r\n  constructor(game) {\r\n    super("SensitivityToProximityToWest", game);\r\n  }\r\n\r\n  getValue(creature) {\r\n    var scaledGameWidth = this.game.width * this.game.divisionSize;\r\n    var invertedX = scaledGameWidth - creature.position.x;\r\n    var scaledInput = this.scaleValue(invertedX, 0, 1, 0, scaledGameWidth);\r\n    return scaledInput;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/inputs/SensitivityToProximityToSouth.js\n\r\n\r\nclass SensitivityToProximityToSouth_SensitivityToProximityToSouth extends Neuron {\r\n  constructor(game) {\r\n    super("SensitivityToProximityToSouth", game);\r\n  }\r\n\r\n  getValue(creature) {\r\n    var scaledGameHeight = this.game.height * this.game.divisionSize;\r\n    var scaledInput = this.scaleValue(creature.position.y, 0, 1, 0, scaledGameHeight);\r\n    return scaledInput;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/inputs/SensitivityToProximityToNorth.js\n\r\n\r\nclass SensitivityToProximityToNorth_SensitivityToProximityToNorth extends Neuron {\r\n  constructor(game) {\r\n    super("SensitivityToProximityToNorth", game);\r\n  }\r\n\r\n  /*\r\n    if creature.y = 0 return 1\r\n    if creature.y = 128 return 0\r\n  */\r\n  getValue(creature) {\r\n    var scaledGameHeight = this.game.height * this.game.divisionSize;\r\n    var invertedY = scaledGameHeight - creature.position.y;\r\n    var scaledInput = this.scaleValue(invertedY, 0, 1, 0, scaledGameHeight);\r\n    return scaledInput;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/bit-operations.js\nfunction checkBit(number, bitToCheck) {\r\n  var mask = (1 << bitToCheck) >>> 0;\r\n  var result = (number & mask) >>> 0;\r\n  return result !== 0;\r\n}\r\n\r\nfunction slice(number, start, end) {\r\n  var mask = Math.pow(2, end - start + 1) - 1;\r\n  mask = mask << start;\r\n  var result = number & mask;\r\n  return result >> start;\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/connection.js\nclass Connection {\r\n  constructor(source, sink, weight) {\r\n    this.source = source;\r\n    this.sink = sink;\r\n    this.weight = weight;\r\n  }\r\n\r\n  toString() {\r\n    return `${this.source}:${this.sink}:${this.weight}`;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/GoNorth.js\n\r\n\r\nclass GoNorth_GoNorth extends Neuron {\r\n  constructor() {\r\n    super("GoNorth");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    creature.position.y -= creature.speed * creature.dimensions.width;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/GoNorthEast.js\n\r\n\r\nclass GoNorthEast_GoNorthEast extends Neuron {\r\n  constructor() {\r\n    super("GoNorthEast");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    creature.position.y -= creature.speed * creature.dimensions.width;\r\n    creature.position.x += creature.speed * creature.dimensions.width;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/GoEast.js\n\r\n\r\nclass GoEast_GoEast extends Neuron {\r\n  constructor() {\r\n    super("GoEast");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    creature.position.x += creature.speed * creature.dimensions.width;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/GoSouthEast.js\n\r\n\r\nclass GoSouthEast_GoSouthEast extends Neuron {\r\n  constructor() {\r\n    super("GoSouthEast");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    creature.position.x += creature.speed * creature.dimensions.width;\r\n    creature.position.y += creature.speed * creature.dimensions.width;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/GoSouth.js\n\r\n\r\nclass GoSouth_GoSouth extends Neuron {\r\n  constructor() {\r\n    super("GoSouth");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    creature.position.y += creature.speed * creature.dimensions.width;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/GoSouthWest.js\n\r\n\r\nclass GoSouthWest_GoSouthWest extends Neuron {\r\n  constructor() {\r\n    super("GoSouthWest");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    creature.position.y += creature.speed * creature.dimensions.width;\r\n    creature.position.x -= creature.speed * creature.dimensions.width;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/GoWest.js\n\r\n\r\nclass GoWest_GoWest extends Neuron {\r\n  constructor() {\r\n    super("GoWest");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    creature.position.x -= creature.speed * creature.dimensions.width;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/GoNorthWest.js\n\r\n\r\nclass GoNorthWest_GoNorthWest extends Neuron {\r\n  constructor() {\r\n    super("GoNorthWest");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    creature.position.y -= creature.speed * creature.dimensions.width;\r\n    creature.position.x -= creature.speed * creature.dimensions.width;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/outputs/DoNothing.js\n\r\n\r\nclass DoNothing_DoNothing extends Neuron {\r\n  constructor() {\r\n    super("DoNothing");\r\n  }\r\n\r\n  applyAction(creature) {\r\n    return;\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/nn/neural-network.js\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass neural_network_NeuralNetwork {\r\n  constructor(numberOfHiddenNeurons, genome, sensitivityNeuronFactory) {\r\n    this.genome = genome;\r\n    this.hiddenNeurons = new Array(numberOfHiddenNeurons);\r\n\r\n    for (let index = 0; index < this.hiddenNeurons.length; index++) {\r\n      this.hiddenNeurons[index] = new Neuron(`Hidden Layer ${index}`);\r\n    }\r\n\r\n    this.inputNeurons = [\r\n      sensitivityNeuronFactory("SensitivityToProximityToEast"),\r\n      sensitivityNeuronFactory("SensitivityToProximityToNorth"),\r\n      sensitivityNeuronFactory("SensitivityToProximityToSouth"),\r\n      sensitivityNeuronFactory("SensitivityToProximityToWest"),\r\n    ];\r\n\r\n    this.outputNeurons = [\r\n      new DoNothing_DoNothing(),\r\n      new GoNorth_GoNorth(),\r\n      new GoNorthEast_GoNorthEast(),\r\n      new GoEast_GoEast(),\r\n      new GoSouthEast_GoSouthEast(),\r\n      new GoSouth_GoSouth(),\r\n      new GoSouthWest_GoSouthWest(),\r\n      new GoWest_GoWest(),\r\n      new GoNorthWest_GoNorthWest(),\r\n    ];\r\n\r\n    for (let index = 0; index < this.genome.size; index++) {\r\n      var chromosome = this.genome.chromosomes[index];\r\n      this.addConnection(chromosome);\r\n    }\r\n  }\r\n\r\n  scaleWeight(weight, xMin, xMax, yMin, yMax) {\r\n    var percent = (weight - yMin) / (yMax - yMin);\r\n    return percent * (xMax - xMin) + xMin;\r\n  }\r\n\r\n  // first bit is source type (i.e 0 = sensor neuron, or 1 hidden neuron)\r\n  // next 5 bits determine which instance of that source type we have\r\n  // next bit is the sink type (i.e an internal neuron or an action/output neuron)\r\n  // next 20 bits is the weight of the connection\r\n\r\n  //      31| 30-26 | 25| 24-20 |19-----------------0\r\n  //       1| 01110 | 0 | 11000 |10010111001011000101\r\n  //E.g.   0| 00011 | 0 | 01100 |11001100110011001100\r\n  //                             10000000000000000000\r\n  //                             11111111111111111111 = 0 to 1048575\r\n  addConnection(chromosome) {\r\n    var sourceIsAnInputNeuron = checkBit(chromosome, 31); // 0 based index on the bits, i.e. 0 is furthest right (least significant bit)\r\n    var getSourceInstance = slice(chromosome, 26, 30) % (sourceIsAnInputNeuron ? this.inputNeurons.length : this.hiddenNeurons.length);\r\n    var sinkIsAnOutputNeuron = checkBit(chromosome, 25);\r\n    var getOutputInstance = slice(chromosome, 20, 24) % (sinkIsAnOutputNeuron ? this.outputNeurons.length : this.hiddenNeurons.length);\r\n    var weight = this.scaleWeight(slice(chromosome, 0, 19), -4, 4, 0, 1048575);\r\n\r\n    var source;\r\n    var sink;\r\n\r\n    if (sourceIsAnInputNeuron) {\r\n      // get the sensor type\r\n      source = this.inputNeurons[getSourceInstance];\r\n    } else {\r\n      // this is a hidden layer neuron\r\n      source = this.hiddenNeurons[getSourceInstance];\r\n    }\r\n\r\n    if (sinkIsAnOutputNeuron) {\r\n      // get the action type\r\n      sink = this.outputNeurons[getOutputInstance];\r\n    } else {\r\n      // this is a hidden layer neuron\r\n      sink = this.hiddenNeurons[getOutputInstance];\r\n    }\r\n\r\n    sink.addConnection(new Connection(source, sink, weight));\r\n  }\r\n\r\n  feedForward(creature) {\r\n    // Only return output neurons with a positive "probability"\r\n    return this.outputNeurons.filter((n) => {\r\n      var outputForN = this.feedForwardPer(n, creature);\r\n      n.updateLastValue(outputForN);\r\n      return outputForN > 0;\r\n    });\r\n  }\r\n\r\n  feedForwardPer(neuron, creature) {\r\n    var depth = 0;\r\n\r\n    let getInput = (connection, seenNodes) => {\r\n      depth++;\r\n      if (depth > 15) {\r\n        debugger;\r\n      }\r\n      // this connection has a source and a weight, need to get the source input value * weight and return that\r\n      var sink = connection.sink;\r\n      var source = connection.source;\r\n      var weight = connection.weight;\r\n      seenNodes.set(sink, sink.getValue(creature));\r\n\r\n      if (seenNodes.has(source)) {\r\n        return seenNodes.get(source);\r\n      } else if (source.connections.length === 0) {\r\n        // we\'re at the top of the tree so return the value of the input * weight\r\n        var input = source.getValue(creature);\r\n        return input * weight;\r\n      } else {\r\n        // we still have more connections to get\r\n        var sumOfWeightedInputs = 0;\r\n        for (let index = 0; index < source.connections.length; index++) {\r\n          const connection = source.connections[index];\r\n          sumOfWeightedInputs += getInput(connection, seenNodes);\r\n        }\r\n\r\n        return Math.tanh(sumOfWeightedInputs);\r\n      }\r\n    };\r\n\r\n    var sumOfWeightedInputs = 0;\r\n    for (let index = 0; index < neuron.connections.length; index++) {\r\n      const seenNodes = new Map();\r\n      const connection = neuron.connections[index];\r\n      sumOfWeightedInputs += getInput(connection, seenNodes);\r\n    }\r\n    return Math.tanh(sumOfWeightedInputs);\r\n  }\r\n}\r\n\n// CONCATENATED MODULE: ./src/simulation.js\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "default", function() { return simulation_Simulation; });\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nclass simulation_Simulation {\r\n  constructor(\r\n    sizeOfPopulation,\r\n    numberOfGenerationsToRun,\r\n    movesPerGeneration,\r\n    framesPerSecond,\r\n    sizeOfGenome,\r\n    numberOfNeuronsInHiddenLayer,\r\n    mutationRate,\r\n    successCriteriaVisualization\r\n  ) {\r\n    this.sizeOfPopulation = sizeOfPopulation;\r\n    this.numberOfGenerationsToRun = numberOfGenerationsToRun;\r\n    this.movesPerGeneration = movesPerGeneration;\r\n    this.framesPerSecond = framesPerSecond;\r\n    this.sizeOfGenome = sizeOfGenome;\r\n    this.numberOfNeuronsInHiddenLayer = numberOfNeuronsInHiddenLayer;\r\n    this.mutationRate = mutationRate;\r\n    this.successCriteriaVisualization = successCriteriaVisualization;\r\n\r\n    this._sensitivityNeuronFactory = (game) => (type) => {\r\n      switch (type) {\r\n        case "SensitivityToProximityToEast":\r\n          return new SensitivityToProximityToEast_SensitivityToProximityToEast(game);\r\n        case "SensitivityToProximityToWest":\r\n          return new SensitivityToProximityToWest_SensitivityToProximityToWest(game);\r\n        case "SensitivityToProximityToSouth":\r\n          return new SensitivityToProximityToSouth_SensitivityToProximityToSouth(game);\r\n        case "SensitivityToProximityToNorth":\r\n          return new SensitivityToProximityToNorth_SensitivityToProximityToNorth(game);\r\n        default:\r\n          break;\r\n      }\r\n    };\r\n\r\n    this.currentStepCount = 0;\r\n    this.currentGenerationCount = 0;\r\n    this.generationCountLabel = document.createElement("h1");\r\n    document.body.appendChild(this.generationCountLabel);\r\n    this.stepCountLabel = document.createElement("h1");\r\n    document.body.appendChild(this.stepCountLabel);\r\n  }\r\n\r\n  _randomNumberBetween(min, max) {\r\n    return Math.floor(Math.random() * (max - min) + 1);\r\n  }\r\n\r\n  _roundToNearest(numberToRound, valueToNearest) {\r\n    return Math.ceil(numberToRound / valueToNearest) * valueToNearest;\r\n  }\r\n\r\n  _getPositionWithin(game) {\r\n    return this._roundToNearest(this._randomNumberBetween(0, game.width * game.divisionSize - game.divisionSize), game.divisionSize);\r\n  }\r\n\r\n  _initialiseGame() {\r\n    this.game = new Game(128, 128, 5, false, this.successCriteriaVisualization);\r\n  }\r\n\r\n  _generateInitialCohort() {\r\n    for (let index = 0; index < this.sizeOfPopulation; index++) {\r\n      // 0,0 to 635,635\r\n      const genome = new Genome(this.sizeOfGenome);\r\n      const neuralNetwork = new neural_network_NeuralNetwork(this.numberOfNeuronsInHiddenLayer, genome, this._sensitivityNeuronFactory(this.game));\r\n      const creature = new Creature(\r\n        genome,\r\n        neuralNetwork,\r\n        this._getPositionWithin(this.game),\r\n        this._getPositionWithin(this.game),\r\n        this.game.divisionSize,\r\n        this.game.width,\r\n        this.game.height,\r\n        1,\r\n        false\r\n      );\r\n      this.game.addCreature(creature);\r\n    }\r\n  }\r\n\r\n  _generateNextCohort(survivors) {\r\n    this.game.gameCreatures = [];\r\n    for (let indexOne = 0, indexTwo = 2; indexTwo < survivors.length; indexOne++, indexTwo++) {\r\n      const parentOne = survivors[indexOne];\r\n      const parentTwo = survivors[indexOne + 1];\r\n      const parentOneGenome = parentOne.genome;\r\n      const parentTwoGenome = parentTwo.genome;\r\n      var childGenomeOne = Genome.createNewGenomeFromParents(parentOneGenome, parentTwoGenome);\r\n      var childGenomeTwo = Genome.createNewGenomeFromParents(parentTwoGenome, parentOneGenome);\r\n      const neuralNetworkOne = new neural_network_NeuralNetwork(\r\n        this.numberOfNeuronsInHiddenLayer,\r\n        childGenomeOne,\r\n        this._sensitivityNeuronFactory(this.game)\r\n      );\r\n      const neuralNetworkTwo = new neural_network_NeuralNetwork(\r\n        this.numberOfNeuronsInHiddenLayer,\r\n        childGenomeTwo,\r\n        this._sensitivityNeuronFactory(this.game)\r\n      );\r\n\r\n      const creatureOne = new Creature(\r\n        childGenomeOne,\r\n        neuralNetworkOne,\r\n        this._getPositionWithin(this.game),\r\n        this._getPositionWithin(this.game),\r\n        this.game.divisionSize,\r\n        this.game.width,\r\n        this.game.height,\r\n        1,\r\n        false\r\n      );\r\n\r\n      const creatureTwo = new Creature(\r\n        childGenomeTwo,\r\n        neuralNetworkTwo,\r\n        this._getPositionWithin(this.game),\r\n        this._getPositionWithin(this.game),\r\n        this.game.divisionSize,\r\n        this.game.width,\r\n        this.game.height,\r\n        1,\r\n        false\r\n      );\r\n\r\n      this.game.addCreature(creatureOne);\r\n      this.game.addCreature(creatureTwo);\r\n    }\r\n  }\r\n\r\n  _animate() {\r\n    this.stepCountLabel.innerText = `Generation Step Count: ${this.currentStepCount++}`;\r\n    this.game.update();\r\n    if (this.currentStepCount <= this.movesPerGeneration) {\r\n      setTimeout(() => requestAnimationFrame(this._animate.bind(this)), 1000 / this.framesPerSecond);\r\n    } else {\r\n      // This generation has finished, time to get the survivors to reproduce\r\n      // Then set the board back with the new generation\r\n      this.generationCountLabel.innerText = `Gen ${++this.currentGenerationCount}`;\r\n      const survivors = this.game.getSurvivors(this.successCriteriaVisualization.successCriteria);\r\n      console.log(`Number of survivors ${survivors.length}.`);\r\n      this._generateNextCohort(survivors);\r\n      this.currentStepCount = 0;\r\n      this._animate();\r\n    }\r\n  }\r\n\r\n  start() {\r\n    this.generationCountLabel.innerText = `Gen ${this.currentGenerationCount}`;\r\n    this._initialiseGame();\r\n    this._generateInitialCohort();\r\n    this._animate();\r\n  }\r\n}\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY3JlYXR1cmUuanM/MDE0YyIsIndlYnBhY2s6Ly8vLi9zcmMvZ2FtZS5qcz83ZGUwIiwid2VicGFjazovLy8uL3NyYy9nZW5vbWUuanM/ZGZjNSIsIndlYnBhY2s6Ly8vLi9zcmMvbm4vbmV1cm9uLmpzP2VlNDciLCJ3ZWJwYWNrOi8vLy4vc3JjL25uL2lucHV0cy9TZW5zaXRpdml0eVRvUHJveGltaXR5VG9FYXN0LmpzPzI1NDAiLCJ3ZWJwYWNrOi8vLy4vc3JjL25uL2lucHV0cy9TZW5zaXRpdml0eVRvUHJveGltaXR5VG9XZXN0LmpzP2I2NWQiLCJ3ZWJwYWNrOi8vLy4vc3JjL25uL2lucHV0cy9TZW5zaXRpdml0eVRvUHJveGltaXR5VG9Tb3V0aC5qcz81NjdjIiwid2VicGFjazovLy8uL3NyYy9ubi9pbnB1dHMvU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvTm9ydGguanM/ZTJjZiIsIndlYnBhY2s6Ly8vLi9zcmMvYml0LW9wZXJhdGlvbnMuanM/YjBlZiIsIndlYnBhY2s6Ly8vLi9zcmMvbm4vY29ubmVjdGlvbi5qcz9iMjc0Iiwid2VicGFjazovLy8uL3NyYy9ubi9vdXRwdXRzL0dvTm9ydGguanM/MmZhZCIsIndlYnBhY2s6Ly8vLi9zcmMvbm4vb3V0cHV0cy9Hb05vcnRoRWFzdC5qcz8zZDBmIiwid2VicGFjazovLy8uL3NyYy9ubi9vdXRwdXRzL0dvRWFzdC5qcz80NWQxIiwid2VicGFjazovLy8uL3NyYy9ubi9vdXRwdXRzL0dvU291dGhFYXN0LmpzP2VhYjkiLCJ3ZWJwYWNrOi8vLy4vc3JjL25uL291dHB1dHMvR29Tb3V0aC5qcz85OTRkIiwid2VicGFjazovLy8uL3NyYy9ubi9vdXRwdXRzL0dvU291dGhXZXN0LmpzP2JlYTMiLCJ3ZWJwYWNrOi8vLy4vc3JjL25uL291dHB1dHMvR29XZXN0LmpzPzY2MTAiLCJ3ZWJwYWNrOi8vLy4vc3JjL25uL291dHB1dHMvR29Ob3J0aFdlc3QuanM/ODY4MiIsIndlYnBhY2s6Ly8vLi9zcmMvbm4vb3V0cHV0cy9Eb05vdGhpbmcuanM/ZjUxZSIsIndlYnBhY2s6Ly8vLi9zcmMvbm4vbmV1cmFsLW5ldHdvcmsuanM/MDU0OCIsIndlYnBhY2s6Ly8vLi9zcmMvc2ltdWxhdGlvbi5qcz9jOTNkIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZUFBZSx1REFBdUQ7QUFDdEU7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87O0FBRVAsZ0ZBQWdGO0FBQ2hGO0FBQ0E7O0FBRUE7QUFDQSxvQkFBb0IsdUJBQXVCO0FBQzNDOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FDOUZlO0FBQ2Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0Q7QUFDL0Q7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1AsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1Qyx3Q0FBd0M7QUFDL0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsdUNBQXVDLHlDQUF5QztBQUNoRjtBQUNBO0FBQ0E7QUFDQTtBQUNB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bGUiOiIzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ3JlYXR1cmUge1xyXG4gIGNvbnN0cnVjdG9yKGdlbm9tZSwgbmV1cmFsTmV0d29yaywgc3RhcnRpbmdYLCBzdGFydGluZ1ksIGRpbWVuc2lvbiwgZ2FtZVdpZHRoLCBnYW1lSGVpZ2h0LCBzcGVlZCwgZHJhd0luZm8pIHtcclxuICAgIHRoaXMuZ2Vub21lID0gZ2Vub21lO1xyXG4gICAgdGhpcy5uZXVyYWxOZXR3b3JrID0gbmV1cmFsTmV0d29yaztcclxuICAgIHRoaXMuZ2FtZVdpZHRoID0gZ2FtZVdpZHRoO1xyXG4gICAgdGhpcy5nYW1lSGVpZ2h0ID0gZ2FtZUhlaWdodDtcclxuICAgIHRoaXMuc3BlZWQgPSBzcGVlZDtcclxuICAgIHRoaXMuZHJhd0luZm8gPSBkcmF3SW5mbztcclxuICAgIHRoaXMuZGltZW5zaW9ucyA9IHtcclxuICAgICAgd2lkdGg6IGRpbWVuc2lvbixcclxuICAgICAgaGVpZ2h0OiBkaW1lbnNpb24sXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMucG9zaXRpb24gPSB7XHJcbiAgICAgIHg6IHN0YXJ0aW5nWCxcclxuICAgICAgeTogc3RhcnRpbmdZLFxyXG4gICAgfTtcclxuXHJcbiAgICB0aGlzLmdlbmVyYXRlQ29sb3VyKCk7XHJcbiAgfVxyXG5cclxuICBzY2FsZVZhbHVlKHZhbHVlLCB4TWluLCB4TWF4LCB5TWluLCB5TWF4KSB7XHJcbiAgICB2YXIgcGVyY2VudCA9ICh2YWx1ZSAtIHlNaW4pIC8gKHlNYXggLSB5TWluKTtcclxuICAgIHJldHVybiBwZXJjZW50ICogKHhNYXggLSB4TWluKSArIHhNaW47XHJcbiAgfVxyXG5cclxuICBnZXRSYW5kb21Db2xvdXIoc2NhbGVkR2Vub21lTnVtYmVyKSB7XHJcbiAgICByZXR1cm4gYCMke01hdGguZmxvb3Ioc2NhbGVkR2Vub21lTnVtYmVyICogMTY3NzcyMTUpLnRvU3RyaW5nKDE2KX1gO1xyXG4gIH1cclxuXHJcbiAgZ2VuZXJhdGVDb2xvdXIoKSB7XHJcbiAgICB2YXIgZ2Vub21lQ29sb3VyID1cclxuICAgICAgdGhpcy5nZW5vbWUuY2hyb21vc29tZXMucmVkdWNlKChsYXN0VmFsdWUsIGN1cnJlbnRWYWx1ZSkgPT4ge1xyXG4gICAgICAgIGxhc3RWYWx1ZSBePSBjdXJyZW50VmFsdWU7XHJcbiAgICAgICAgcmV0dXJuIGxhc3RWYWx1ZSA+Pj4gMDtcclxuICAgICAgfSwgdGhpcy5nZW5vbWUuY2hyb21vc29tZXNbMF0pID4+PiAwO1xyXG5cclxuICAgIHZhciBzY2FsZWRHZW5vbWVDb2xvdXIgPSB0aGlzLnNjYWxlVmFsdWUoZ2Vub21lQ29sb3VyLCAwLCAxLCAwLCA0Mjk0OTY3Mjk1KTsgLy8gTWF4IHZhbHVlIG9mIHVuc2lnbmVkIDMyIGJpdCBpbnQuLi4gNDI5NDk2NzI5NVxyXG4gICAgdGhpcy5jb2xvdXIgPSB0aGlzLmdldFJhbmRvbUNvbG91cihzY2FsZWRHZW5vbWVDb2xvdXIpO1xyXG4gIH1cclxuXHJcbiAgZHJhd2VyTGFibGUoY3R4KSB7XHJcbiAgICBjdHguZmlsbFRleHQoYCR7dGhpcy5nZW5vbWUudG9TdHJpbmcoKX1gLCB0aGlzLnBvc2l0aW9uLnggLSAxMCwgdGhpcy5wb3NpdGlvbi55IC0gMTApO1xyXG4gIH1cclxuXHJcbiAgZHJhd2VyKGN0eCkge1xyXG4gICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29sb3VyO1xyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgY3R4LmVsbGlwc2UoXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueCArIHRoaXMuZGltZW5zaW9ucy53aWR0aCAvIDIsXHJcbiAgICAgIHRoaXMucG9zaXRpb24ueSArIHRoaXMuZGltZW5zaW9ucy5oZWlnaHQgLyAyLFxyXG4gICAgICB0aGlzLmRpbWVuc2lvbnMud2lkdGggLyAyLFxyXG4gICAgICB0aGlzLmRpbWVuc2lvbnMuaGVpZ2h0IC8gMixcclxuICAgICAgMCxcclxuICAgICAgMCxcclxuICAgICAgMiAqIE1hdGguUElcclxuICAgICk7XHJcbiAgICBjdHguZmlsbCgpO1xyXG4gICAgY3R4LmNsb3NlUGF0aCgpO1xyXG4gICAgaWYgKHRoaXMuZHJhd0luZm8pIHtcclxuICAgICAgdGhpcy5kcmF3ZXJMYWJsZShjdHgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdXBkYXRlKGFjdGlvblByb2JhYmlsaXRpZXMpIHtcclxuICAgIGNvbnN0IGN1cnJlbnRQb3NpdGlvbiA9IHtcclxuICAgICAgLi4udGhpcy5wb3NpdGlvbixcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGFjdGlvblByb2JhYmlsaXRpZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICB2YXIgY3VycmVudFByb2JhYmlsaXR5Um9sbCA9IE1hdGgucmFuZG9tKCk7XHJcbiAgICAgIHZhciBiZXN0QWN0aW9uID0gYWN0aW9uUHJvYmFiaWxpdGllcy5zb3J0KChhLCBiKSA9PiBiIC0gYSlbMF07XHJcbiAgICAgIC8vY29uc29sZS5sb2coYmVzdEFjdGlvbi5nZXRWYWx1ZSgpKTtcclxuXHJcbiAgICAgIGlmIChjdXJyZW50UHJvYmFiaWxpdHlSb2xsIDwgYmVzdEFjdGlvbi5nZXRWYWx1ZSgpKSB7XHJcbiAgICAgICAgYmVzdEFjdGlvbi5hcHBseUFjdGlvbih0aGlzKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoXHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbi54IDwgMCB8fFxyXG4gICAgICAgIHRoaXMucG9zaXRpb24ueCA+PSB0aGlzLmdhbWVXaWR0aCAqIHRoaXMuZGltZW5zaW9ucy53aWR0aCB8fFxyXG4gICAgICAgIHRoaXMucG9zaXRpb24ueSA8IDAgfHxcclxuICAgICAgICB0aGlzLnBvc2l0aW9uLnkgPj0gdGhpcy5nYW1lSGVpZ2h0ICogdGhpcy5kaW1lbnNpb25zLmhlaWdodFxyXG4gICAgICApIHtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwiSGl0IEVkZ2VcIik7XHJcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IGN1cnJlbnRQb3NpdGlvbjtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgdXBkYXRlQW5kUmVkcmF3ZXIoY3R4KSB7XHJcbiAgICB2YXIgYWN0aW9uUHJvYmFiaWxpdGllcyA9IHRoaXMubmV1cmFsTmV0d29yay5mZWVkRm9yd2FyZCh0aGlzKTtcclxuICAgIHRoaXMudXBkYXRlKGFjdGlvblByb2JhYmlsaXRpZXMpO1xyXG4gICAgdGhpcy5kcmF3ZXIoY3R4KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2FtZSB7XHJcbiAgY29uc3RydWN0b3IoR0FNRV9IRUlHSFQsIEdBTUVfV0lEVEgsIERJVklTSU9OX1NJWkUsIFNIT1dfR1JBUEgsIHN1Y2Nlc3NDcml0ZXJpYSkge1xyXG4gICAgdGhpcy5oZWlnaHQgPSBHQU1FX0hFSUdIVDtcclxuICAgIHRoaXMud2lkdGggPSBHQU1FX1dJRFRIO1xyXG4gICAgdGhpcy5kaXZpc2lvblNpemUgPSBESVZJU0lPTl9TSVpFO1xyXG4gICAgdGhpcy5zaG93R3JhcGggPSBTSE9XX0dSQVBIO1xyXG4gICAgdGhpcy5zdWNjZXNzQ3JpdGVyaWEgPSBzdWNjZXNzQ3JpdGVyaWE7XHJcbiAgICB0aGlzLmdhbWVDcmVhdHVyZXMgPSBbXTtcclxuXHJcbiAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICB0aGlzLmNhbnZhcy5zZXRBdHRyaWJ1dGUoXCJpZFwiLCBcImNhbnZhc1wiKTtcclxuICAgIHRoaXMuY2FudmFzLnNldEF0dHJpYnV0ZShcIndpZHRoXCIsIEdBTUVfV0lEVEggKiBESVZJU0lPTl9TSVpFKTtcclxuICAgIHRoaXMuY2FudmFzLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLCBHQU1FX0hFSUdIVCAqIERJVklTSU9OX1NJWkUpO1xyXG4gICAgdGhpcy5jYW52YXMuc2V0QXR0cmlidXRlKFwic3R5bGVcIiwgXCJib3JkZXI6IDFweCBzb2xpZCBibGFjazsgYm94LXNpemluZzogYm9yZGVyLWJveFwiKTtcclxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5jYW52YXMpO1xyXG4gICAgdGhpcy5jdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gIH1cclxuXHJcbiAgYWRkQ3JlYXR1cmUoY3JlYXR1cmUpIHtcclxuICAgIHRoaXMuZ2FtZUNyZWF0dXJlcy5wdXNoKGNyZWF0dXJlKTtcclxuICB9XHJcblxyXG4gIGdldFN1cnZpdm9ycyhzdWNjZXNzQ3JpdGVyaWEpIHtcclxuICAgIHJldHVybiB0aGlzLmdhbWVDcmVhdHVyZXMuZmlsdGVyKChjKSA9PiB7XHJcbiAgICAgIHJldHVybiBzdWNjZXNzQ3JpdGVyaWEuc29tZSgoY3JpdGVyaWEpID0+IHtcclxuICAgICAgICBjb25zdCB4Qm90dG9tID0gY3JpdGVyaWEueCArIGNyaXRlcmlhLndpZHRoO1xyXG4gICAgICAgIGNvbnN0IHlCb3R0b20gPSBjcml0ZXJpYS55ICsgY3JpdGVyaWEuaGVpZ2h0O1xyXG4gICAgICAgIHJldHVybiBjLnBvc2l0aW9uLnggPj0gY3JpdGVyaWEueCAmJiBjLnBvc2l0aW9uLnkgPj0gY3JpdGVyaWEueSAmJiBjLnBvc2l0aW9uLnggPD0geEJvdHRvbSAmJiBjLnBvc2l0aW9uLnkgPD0geUJvdHRvbTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGRyYXdHcmlkKCkge1xyXG4gICAgdGhpcy5jdHgubGluZVdpZHRoID0gMC41O1xyXG4gICAgLy8gRG8gY29sdW1uc1xyXG4gICAgZm9yIChsZXQgaW5kZXggPSB0aGlzLmRpdmlzaW9uU2l6ZTsgaW5kZXggPCB0aGlzLndpZHRoICogdGhpcy5kaXZpc2lvblNpemU7IGluZGV4ICs9IHRoaXMuZGl2aXNpb25TaXplKSB7XHJcbiAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xyXG4gICAgICB0aGlzLmN0eC5tb3ZlVG8oaW5kZXgsIDApO1xyXG4gICAgICB0aGlzLmN0eC5saW5lVG8oaW5kZXgsIHRoaXMuaGVpZ2h0ICogdGhpcy5kaXZpc2lvblNpemUpO1xyXG4gICAgICB0aGlzLmN0eC5zdHJva2UoKTtcclxuICAgICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gRG8gUm93c1xyXG4gICAgZm9yIChsZXQgaW5kZXggPSB0aGlzLmRpdmlzaW9uU2l6ZTsgaW5kZXggPCB0aGlzLmhlaWdodCAqIHRoaXMuZGl2aXNpb25TaXplOyBpbmRleCArPSB0aGlzLmRpdmlzaW9uU2l6ZSkge1xyXG4gICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcclxuICAgICAgdGhpcy5jdHgubW92ZVRvKDAsIGluZGV4KTtcclxuICAgICAgdGhpcy5jdHgubGluZVRvKHRoaXMud2lkdGggKiB0aGlzLmRpdmlzaW9uU2l6ZSwgaW5kZXgpO1xyXG4gICAgICB0aGlzLmN0eC5zdHJva2UoKTtcclxuICAgICAgdGhpcy5jdHguY2xvc2VQYXRoKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cGRhdGUoKSB7XHJcbiAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSBcIndoaXRlXCI7XHJcbiAgICB0aGlzLmN0eC5maWxsUmVjdCgwLCAwLCB0aGlzLndpZHRoICogdGhpcy5kaXZpc2lvblNpemUsIHRoaXMuaGVpZ2h0ICogdGhpcy5kaXZpc2lvblNpemUpO1xyXG4gICAgdGhpcy5nYW1lQ3JlYXR1cmVzLmZvckVhY2goKGNyZWF0dXJlKSA9PiB7XHJcbiAgICAgIGNyZWF0dXJlLnVwZGF0ZUFuZFJlZHJhd2VyKHRoaXMuY3R4KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGlmICh0aGlzLnNob3dHcmFwaCkge1xyXG4gICAgICB0aGlzLmRyYXdHcmlkKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5zdWNjZXNzQ3JpdGVyaWEuZHJhd2VyKHRoaXMuY3R4KTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgR2Vub21lIHtcclxuICBjb25zdHJ1Y3RvcihzaXplLCBnZW5lcmF0ZVJhbmRvbVZhbHVlcyA9IHRydWUpIHtcclxuICAgIGlmIChzaXplICUgMiAhPT0gMCkge1xyXG4gICAgICB0aHJvdyBcIkdlbm9tZSBzaXplIG11c3QgYmUgYW4gZXZlbiBudW1iZXIuXCI7XHJcbiAgICB9XHJcbiAgICB0aGlzLnNpemUgPSBzaXplO1xyXG4gICAgdGhpcy5jaHJvbW9zb21lcyA9IG5ldyBVaW50MzJBcnJheShzaXplKTtcclxuICAgIGlmIChnZW5lcmF0ZVJhbmRvbVZhbHVlcykge1xyXG4gICAgICB3aW5kb3cuY3J5cHRvLmdldFJhbmRvbVZhbHVlcyh0aGlzLmNocm9tb3NvbWVzKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHN0YXRpYyBjcmVhdGVOZXdHZW5vbWVGcm9tUGFyZW50cyhnZW5vbWVPbmUsIGdlbm9tZVR3bykge1xyXG4gICAgdmFyIHRha2VGcm9tUGFyZW50T25lRmlyc3QgPSBNYXRoLnJhbmRvbSgpID4gMC41O1xyXG4gICAgdmFyIHNpemUgPSBnZW5vbWVPbmUuc2l6ZTtcclxuICAgIHZhciBuZXdHZW5vbWUgPSBuZXcgR2Vub21lKHNpemUsIGZhbHNlKTtcclxuICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzaXplOyBpbmRleCsrKSB7XHJcbiAgICAgIGlmICh0YWtlRnJvbVBhcmVudE9uZUZpcnN0KSB7XHJcbiAgICAgICAgbmV3R2Vub21lLmNocm9tb3NvbWVzW2luZGV4XSA9IGdlbm9tZU9uZS5jaHJvbW9zb21lc1tpbmRleF07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbmV3R2Vub21lLmNocm9tb3NvbWVzW2luZGV4XSA9IGdlbm9tZVR3by5jaHJvbW9zb21lc1tpbmRleF07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRha2VGcm9tUGFyZW50T25lRmlyc3QgPSAhdGFrZUZyb21QYXJlbnRPbmVGaXJzdDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gbmV3R2Vub21lO1xyXG4gIH1cclxuXHJcbiAgdG9TdHJpbmcoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jaHJvbW9zb21lcy5qb2luKFwiOlwiKTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgTmV1cm9uIHtcclxuICBjb25zdHJ1Y3Rvcih0eXBlLCBnYW1lKSB7XHJcbiAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcclxuICAgIHRoaXMuY29ubmVjdGlvbnMgPSBbXTtcclxuICAgIHRoaXMubGFzdFZhbHVlID0gMDtcclxuICB9XHJcblxyXG4gIHNjYWxlVmFsdWUodmFsdWUsIHhNaW4sIHhNYXgsIHlNaW4sIHlNYXgpIHtcclxuICAgIHZhciBwZXJjZW50ID0gKHZhbHVlIC0geU1pbikgLyAoeU1heCAtIHlNaW4pO1xyXG4gICAgcmV0dXJuIHBlcmNlbnQgKiAoeE1heCAtIHhNaW4pICsgeE1pbjtcclxuICB9XHJcblxyXG4gIGFkZENvbm5lY3Rpb24oY29ubmVjdGlvbikge1xyXG4gICAgdGhpcy5jb25uZWN0aW9ucy5wdXNoKGNvbm5lY3Rpb24pO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlTGFzdFZhbHVlKGxhc3RWYWx1ZSkge1xyXG4gICAgdGhpcy5sYXN0VmFsdWUgPSBsYXN0VmFsdWU7XHJcbiAgfVxyXG5cclxuICBnZXRWYWx1ZShjcmVhdHVyZSkge1xyXG4gICAgcmV0dXJuIHRoaXMubGFzdFZhbHVlO1xyXG4gIH1cclxuXHJcbiAgYXBwbHlBY3Rpb24oY3JlYXR1cmUpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIHRvU3RyaW5nKCkge1xyXG4gICAgcmV0dXJuIGAke3RoaXMudHlwZX1gO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgTmV1cm9uIGZyb20gXCIuLi9uZXVyb25cIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb0Vhc3QgZXh0ZW5kcyBOZXVyb24ge1xyXG4gIGNvbnN0cnVjdG9yKGdhbWUpIHtcclxuICAgIHN1cGVyKFwiU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvRWFzdFwiLCBnYW1lKTtcclxuICB9XHJcblxyXG4gIGdldFZhbHVlKGNyZWF0dXJlKSB7XHJcbiAgICB2YXIgc2NhbGVkR2FtZVdpZHRoID0gdGhpcy5nYW1lLndpZHRoICogdGhpcy5nYW1lLmRpdmlzaW9uU2l6ZTtcclxuICAgIHZhciBzY2FsZWRJbnB1dCA9IHRoaXMuc2NhbGVWYWx1ZShjcmVhdHVyZS5wb3NpdGlvbi54LCAwLCAxLCAwLCBzY2FsZWRHYW1lV2lkdGgpO1xyXG4gICAgcmV0dXJuIHNjYWxlZElucHV0O1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgTmV1cm9uIGZyb20gXCIuLi9uZXVyb25cIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb1dlc3QgZXh0ZW5kcyBOZXVyb24ge1xyXG4gIGNvbnN0cnVjdG9yKGdhbWUpIHtcclxuICAgIHN1cGVyKFwiU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvV2VzdFwiLCBnYW1lKTtcclxuICB9XHJcblxyXG4gIGdldFZhbHVlKGNyZWF0dXJlKSB7XHJcbiAgICB2YXIgc2NhbGVkR2FtZVdpZHRoID0gdGhpcy5nYW1lLndpZHRoICogdGhpcy5nYW1lLmRpdmlzaW9uU2l6ZTtcclxuICAgIHZhciBpbnZlcnRlZFggPSBzY2FsZWRHYW1lV2lkdGggLSBjcmVhdHVyZS5wb3NpdGlvbi54O1xyXG4gICAgdmFyIHNjYWxlZElucHV0ID0gdGhpcy5zY2FsZVZhbHVlKGludmVydGVkWCwgMCwgMSwgMCwgc2NhbGVkR2FtZVdpZHRoKTtcclxuICAgIHJldHVybiBzY2FsZWRJbnB1dDtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IE5ldXJvbiBmcm9tIFwiLi4vbmV1cm9uXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZW5zaXRpdml0eVRvUHJveGltaXR5VG9Tb3V0aCBleHRlbmRzIE5ldXJvbiB7XHJcbiAgY29uc3RydWN0b3IoZ2FtZSkge1xyXG4gICAgc3VwZXIoXCJTZW5zaXRpdml0eVRvUHJveGltaXR5VG9Tb3V0aFwiLCBnYW1lKTtcclxuICB9XHJcblxyXG4gIGdldFZhbHVlKGNyZWF0dXJlKSB7XHJcbiAgICB2YXIgc2NhbGVkR2FtZUhlaWdodCA9IHRoaXMuZ2FtZS5oZWlnaHQgKiB0aGlzLmdhbWUuZGl2aXNpb25TaXplO1xyXG4gICAgdmFyIHNjYWxlZElucHV0ID0gdGhpcy5zY2FsZVZhbHVlKGNyZWF0dXJlLnBvc2l0aW9uLnksIDAsIDEsIDAsIHNjYWxlZEdhbWVIZWlnaHQpO1xyXG4gICAgcmV0dXJuIHNjYWxlZElucHV0O1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgTmV1cm9uIGZyb20gXCIuLi9uZXVyb25cIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb05vcnRoIGV4dGVuZHMgTmV1cm9uIHtcclxuICBjb25zdHJ1Y3RvcihnYW1lKSB7XHJcbiAgICBzdXBlcihcIlNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb05vcnRoXCIsIGdhbWUpO1xyXG4gIH1cclxuXHJcbiAgLypcclxuICAgIGlmIGNyZWF0dXJlLnkgPSAwIHJldHVybiAxXHJcbiAgICBpZiBjcmVhdHVyZS55ID0gMTI4IHJldHVybiAwXHJcbiAgKi9cclxuICBnZXRWYWx1ZShjcmVhdHVyZSkge1xyXG4gICAgdmFyIHNjYWxlZEdhbWVIZWlnaHQgPSB0aGlzLmdhbWUuaGVpZ2h0ICogdGhpcy5nYW1lLmRpdmlzaW9uU2l6ZTtcclxuICAgIHZhciBpbnZlcnRlZFkgPSBzY2FsZWRHYW1lSGVpZ2h0IC0gY3JlYXR1cmUucG9zaXRpb24ueTtcclxuICAgIHZhciBzY2FsZWRJbnB1dCA9IHRoaXMuc2NhbGVWYWx1ZShpbnZlcnRlZFksIDAsIDEsIDAsIHNjYWxlZEdhbWVIZWlnaHQpO1xyXG4gICAgcmV0dXJuIHNjYWxlZElucHV0O1xyXG4gIH1cclxufVxyXG4iLCJleHBvcnQgZnVuY3Rpb24gY2hlY2tCaXQobnVtYmVyLCBiaXRUb0NoZWNrKSB7XHJcbiAgdmFyIG1hc2sgPSAoMSA8PCBiaXRUb0NoZWNrKSA+Pj4gMDtcclxuICB2YXIgcmVzdWx0ID0gKG51bWJlciAmIG1hc2spID4+PiAwO1xyXG4gIHJldHVybiByZXN1bHQgIT09IDA7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzbGljZShudW1iZXIsIHN0YXJ0LCBlbmQpIHtcclxuICB2YXIgbWFzayA9IE1hdGgucG93KDIsIGVuZCAtIHN0YXJ0ICsgMSkgLSAxO1xyXG4gIG1hc2sgPSBtYXNrIDw8IHN0YXJ0O1xyXG4gIHZhciByZXN1bHQgPSBudW1iZXIgJiBtYXNrO1xyXG4gIHJldHVybiByZXN1bHQgPj4gc3RhcnQ7XHJcbn1cclxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29ubmVjdGlvbiB7XHJcbiAgY29uc3RydWN0b3Ioc291cmNlLCBzaW5rLCB3ZWlnaHQpIHtcclxuICAgIHRoaXMuc291cmNlID0gc291cmNlO1xyXG4gICAgdGhpcy5zaW5rID0gc2luaztcclxuICAgIHRoaXMud2VpZ2h0ID0gd2VpZ2h0O1xyXG4gIH1cclxuXHJcbiAgdG9TdHJpbmcoKSB7XHJcbiAgICByZXR1cm4gYCR7dGhpcy5zb3VyY2V9OiR7dGhpcy5zaW5rfToke3RoaXMud2VpZ2h0fWA7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBOZXVyb24gZnJvbSBcIi4uL25ldXJvblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEdvTm9ydGggZXh0ZW5kcyBOZXVyb24ge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoXCJHb05vcnRoXCIpO1xyXG4gIH1cclxuXHJcbiAgYXBwbHlBY3Rpb24oY3JlYXR1cmUpIHtcclxuICAgIGNyZWF0dXJlLnBvc2l0aW9uLnkgLT0gY3JlYXR1cmUuc3BlZWQgKiBjcmVhdHVyZS5kaW1lbnNpb25zLndpZHRoO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgTmV1cm9uIGZyb20gXCIuLi9uZXVyb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBHb05vcnRoRWFzdCBleHRlbmRzIE5ldXJvbiB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcihcIkdvTm9ydGhFYXN0XCIpO1xyXG4gIH1cclxuXHJcbiAgYXBwbHlBY3Rpb24oY3JlYXR1cmUpIHtcclxuICAgIGNyZWF0dXJlLnBvc2l0aW9uLnkgLT0gY3JlYXR1cmUuc3BlZWQgKiBjcmVhdHVyZS5kaW1lbnNpb25zLndpZHRoO1xyXG4gICAgY3JlYXR1cmUucG9zaXRpb24ueCArPSBjcmVhdHVyZS5zcGVlZCAqIGNyZWF0dXJlLmRpbWVuc2lvbnMud2lkdGg7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBOZXVyb24gZnJvbSBcIi4uL25ldXJvblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEdvRWFzdCBleHRlbmRzIE5ldXJvbiB7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICBzdXBlcihcIkdvRWFzdFwiKTtcclxuICB9XHJcblxyXG4gIGFwcGx5QWN0aW9uKGNyZWF0dXJlKSB7XHJcbiAgICBjcmVhdHVyZS5wb3NpdGlvbi54ICs9IGNyZWF0dXJlLnNwZWVkICogY3JlYXR1cmUuZGltZW5zaW9ucy53aWR0aDtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IE5ldXJvbiBmcm9tIFwiLi4vbmV1cm9uXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgR29Tb3V0aEVhc3QgZXh0ZW5kcyBOZXVyb24ge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoXCJHb1NvdXRoRWFzdFwiKTtcclxuICB9XHJcblxyXG4gIGFwcGx5QWN0aW9uKGNyZWF0dXJlKSB7XHJcbiAgICBjcmVhdHVyZS5wb3NpdGlvbi54ICs9IGNyZWF0dXJlLnNwZWVkICogY3JlYXR1cmUuZGltZW5zaW9ucy53aWR0aDtcclxuICAgIGNyZWF0dXJlLnBvc2l0aW9uLnkgKz0gY3JlYXR1cmUuc3BlZWQgKiBjcmVhdHVyZS5kaW1lbnNpb25zLndpZHRoO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgTmV1cm9uIGZyb20gXCIuLi9uZXVyb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBHb1NvdXRoIGV4dGVuZHMgTmV1cm9uIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKFwiR29Tb3V0aFwiKTtcclxuICB9XHJcblxyXG4gIGFwcGx5QWN0aW9uKGNyZWF0dXJlKSB7XHJcbiAgICBjcmVhdHVyZS5wb3NpdGlvbi55ICs9IGNyZWF0dXJlLnNwZWVkICogY3JlYXR1cmUuZGltZW5zaW9ucy53aWR0aDtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IE5ldXJvbiBmcm9tIFwiLi4vbmV1cm9uXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgR29Tb3V0aFdlc3QgZXh0ZW5kcyBOZXVyb24ge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoXCJHb1NvdXRoV2VzdFwiKTtcclxuICB9XHJcblxyXG4gIGFwcGx5QWN0aW9uKGNyZWF0dXJlKSB7XHJcbiAgICBjcmVhdHVyZS5wb3NpdGlvbi55ICs9IGNyZWF0dXJlLnNwZWVkICogY3JlYXR1cmUuZGltZW5zaW9ucy53aWR0aDtcclxuICAgIGNyZWF0dXJlLnBvc2l0aW9uLnggLT0gY3JlYXR1cmUuc3BlZWQgKiBjcmVhdHVyZS5kaW1lbnNpb25zLndpZHRoO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgTmV1cm9uIGZyb20gXCIuLi9uZXVyb25cIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBHb1dlc3QgZXh0ZW5kcyBOZXVyb24ge1xyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgc3VwZXIoXCJHb1dlc3RcIik7XHJcbiAgfVxyXG5cclxuICBhcHBseUFjdGlvbihjcmVhdHVyZSkge1xyXG4gICAgY3JlYXR1cmUucG9zaXRpb24ueCAtPSBjcmVhdHVyZS5zcGVlZCAqIGNyZWF0dXJlLmRpbWVuc2lvbnMud2lkdGg7XHJcbiAgfVxyXG59XHJcbiIsImltcG9ydCBOZXVyb24gZnJvbSBcIi4uL25ldXJvblwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEdvTm9ydGhXZXN0IGV4dGVuZHMgTmV1cm9uIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKFwiR29Ob3J0aFdlc3RcIik7XHJcbiAgfVxyXG5cclxuICBhcHBseUFjdGlvbihjcmVhdHVyZSkge1xyXG4gICAgY3JlYXR1cmUucG9zaXRpb24ueSAtPSBjcmVhdHVyZS5zcGVlZCAqIGNyZWF0dXJlLmRpbWVuc2lvbnMud2lkdGg7XHJcbiAgICBjcmVhdHVyZS5wb3NpdGlvbi54IC09IGNyZWF0dXJlLnNwZWVkICogY3JlYXR1cmUuZGltZW5zaW9ucy53aWR0aDtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IE5ldXJvbiBmcm9tIFwiLi4vbmV1cm9uXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgRG9Ob3RoaW5nIGV4dGVuZHMgTmV1cm9uIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHN1cGVyKFwiRG9Ob3RoaW5nXCIpO1xyXG4gIH1cclxuXHJcbiAgYXBwbHlBY3Rpb24oY3JlYXR1cmUpIHtcclxuICAgIHJldHVybjtcclxuICB9XHJcbn1cclxuIiwiaW1wb3J0IHsgY2hlY2tCaXQsIHNsaWNlIH0gZnJvbSBcIi4uL2JpdC1vcGVyYXRpb25zXCI7XHJcbmltcG9ydCBDb25uZWN0aW9uIGZyb20gXCIuL2Nvbm5lY3Rpb25cIjtcclxuaW1wb3J0IE5ldXJvbiBmcm9tIFwiLi9uZXVyb25cIjtcclxuaW1wb3J0IHsgR29Ob3J0aCB9IGZyb20gXCIuL291dHB1dHMvR29Ob3J0aFwiO1xyXG5pbXBvcnQgeyBHb05vcnRoRWFzdCB9IGZyb20gXCIuL291dHB1dHMvR29Ob3J0aEVhc3RcIjtcclxuaW1wb3J0IHsgR29FYXN0IH0gZnJvbSBcIi4vb3V0cHV0cy9Hb0Vhc3RcIjtcclxuaW1wb3J0IHsgR29Tb3V0aEVhc3QgfSBmcm9tIFwiLi9vdXRwdXRzL0dvU291dGhFYXN0XCI7XHJcbmltcG9ydCB7IEdvU291dGggfSBmcm9tIFwiLi9vdXRwdXRzL0dvU291dGhcIjtcclxuaW1wb3J0IHsgR29Tb3V0aFdlc3QgfSBmcm9tIFwiLi9vdXRwdXRzL0dvU291dGhXZXN0XCI7XHJcbmltcG9ydCB7IEdvV2VzdCB9IGZyb20gXCIuL291dHB1dHMvR29XZXN0XCI7XHJcbmltcG9ydCB7IEdvTm9ydGhXZXN0IH0gZnJvbSBcIi4vb3V0cHV0cy9Hb05vcnRoV2VzdFwiO1xyXG5pbXBvcnQgeyBEb05vdGhpbmcgfSBmcm9tIFwiLi9vdXRwdXRzL0RvTm90aGluZ1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTmV1cmFsTmV0d29yayB7XHJcbiAgY29uc3RydWN0b3IobnVtYmVyT2ZIaWRkZW5OZXVyb25zLCBnZW5vbWUsIHNlbnNpdGl2aXR5TmV1cm9uRmFjdG9yeSkge1xyXG4gICAgdGhpcy5nZW5vbWUgPSBnZW5vbWU7XHJcbiAgICB0aGlzLmhpZGRlbk5ldXJvbnMgPSBuZXcgQXJyYXkobnVtYmVyT2ZIaWRkZW5OZXVyb25zKTtcclxuXHJcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5oaWRkZW5OZXVyb25zLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICB0aGlzLmhpZGRlbk5ldXJvbnNbaW5kZXhdID0gbmV3IE5ldXJvbihgSGlkZGVuIExheWVyICR7aW5kZXh9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5pbnB1dE5ldXJvbnMgPSBbXHJcbiAgICAgIHNlbnNpdGl2aXR5TmV1cm9uRmFjdG9yeShcIlNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb0Vhc3RcIiksXHJcbiAgICAgIHNlbnNpdGl2aXR5TmV1cm9uRmFjdG9yeShcIlNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb05vcnRoXCIpLFxyXG4gICAgICBzZW5zaXRpdml0eU5ldXJvbkZhY3RvcnkoXCJTZW5zaXRpdml0eVRvUHJveGltaXR5VG9Tb3V0aFwiKSxcclxuICAgICAgc2Vuc2l0aXZpdHlOZXVyb25GYWN0b3J5KFwiU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvV2VzdFwiKSxcclxuICAgIF07XHJcblxyXG4gICAgdGhpcy5vdXRwdXROZXVyb25zID0gW1xyXG4gICAgICBuZXcgRG9Ob3RoaW5nKCksXHJcbiAgICAgIG5ldyBHb05vcnRoKCksXHJcbiAgICAgIG5ldyBHb05vcnRoRWFzdCgpLFxyXG4gICAgICBuZXcgR29FYXN0KCksXHJcbiAgICAgIG5ldyBHb1NvdXRoRWFzdCgpLFxyXG4gICAgICBuZXcgR29Tb3V0aCgpLFxyXG4gICAgICBuZXcgR29Tb3V0aFdlc3QoKSxcclxuICAgICAgbmV3IEdvV2VzdCgpLFxyXG4gICAgICBuZXcgR29Ob3J0aFdlc3QoKSxcclxuICAgIF07XHJcblxyXG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMuZ2Vub21lLnNpemU7IGluZGV4KyspIHtcclxuICAgICAgdmFyIGNocm9tb3NvbWUgPSB0aGlzLmdlbm9tZS5jaHJvbW9zb21lc1tpbmRleF07XHJcbiAgICAgIHRoaXMuYWRkQ29ubmVjdGlvbihjaHJvbW9zb21lKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHNjYWxlV2VpZ2h0KHdlaWdodCwgeE1pbiwgeE1heCwgeU1pbiwgeU1heCkge1xyXG4gICAgdmFyIHBlcmNlbnQgPSAod2VpZ2h0IC0geU1pbikgLyAoeU1heCAtIHlNaW4pO1xyXG4gICAgcmV0dXJuIHBlcmNlbnQgKiAoeE1heCAtIHhNaW4pICsgeE1pbjtcclxuICB9XHJcblxyXG4gIC8vIGZpcnN0IGJpdCBpcyBzb3VyY2UgdHlwZSAoaS5lIDAgPSBzZW5zb3IgbmV1cm9uLCBvciAxIGhpZGRlbiBuZXVyb24pXHJcbiAgLy8gbmV4dCA1IGJpdHMgZGV0ZXJtaW5lIHdoaWNoIGluc3RhbmNlIG9mIHRoYXQgc291cmNlIHR5cGUgd2UgaGF2ZVxyXG4gIC8vIG5leHQgYml0IGlzIHRoZSBzaW5rIHR5cGUgKGkuZSBhbiBpbnRlcm5hbCBuZXVyb24gb3IgYW4gYWN0aW9uL291dHB1dCBuZXVyb24pXHJcbiAgLy8gbmV4dCAyMCBiaXRzIGlzIHRoZSB3ZWlnaHQgb2YgdGhlIGNvbm5lY3Rpb25cclxuXHJcbiAgLy8gICAgICAzMXwgMzAtMjYgfCAyNXwgMjQtMjAgfDE5LS0tLS0tLS0tLS0tLS0tLS0wXHJcbiAgLy8gICAgICAgMXwgMDExMTAgfCAwIHwgMTEwMDAgfDEwMDEwMTExMDAxMDExMDAwMTAxXHJcbiAgLy9FLmcuICAgMHwgMDAwMTEgfCAwIHwgMDExMDAgfDExMDAxMTAwMTEwMDExMDAxMTAwXHJcbiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwMDAwMDAwMDAwMDAwMDAwMDAwXHJcbiAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgIDExMTExMTExMTExMTExMTExMTExID0gMCB0byAxMDQ4NTc1XHJcbiAgYWRkQ29ubmVjdGlvbihjaHJvbW9zb21lKSB7XHJcbiAgICB2YXIgc291cmNlSXNBbklucHV0TmV1cm9uID0gY2hlY2tCaXQoY2hyb21vc29tZSwgMzEpOyAvLyAwIGJhc2VkIGluZGV4IG9uIHRoZSBiaXRzLCBpLmUuIDAgaXMgZnVydGhlc3QgcmlnaHQgKGxlYXN0IHNpZ25pZmljYW50IGJpdClcclxuICAgIHZhciBnZXRTb3VyY2VJbnN0YW5jZSA9IHNsaWNlKGNocm9tb3NvbWUsIDI2LCAzMCkgJSAoc291cmNlSXNBbklucHV0TmV1cm9uID8gdGhpcy5pbnB1dE5ldXJvbnMubGVuZ3RoIDogdGhpcy5oaWRkZW5OZXVyb25zLmxlbmd0aCk7XHJcbiAgICB2YXIgc2lua0lzQW5PdXRwdXROZXVyb24gPSBjaGVja0JpdChjaHJvbW9zb21lLCAyNSk7XHJcbiAgICB2YXIgZ2V0T3V0cHV0SW5zdGFuY2UgPSBzbGljZShjaHJvbW9zb21lLCAyMCwgMjQpICUgKHNpbmtJc0FuT3V0cHV0TmV1cm9uID8gdGhpcy5vdXRwdXROZXVyb25zLmxlbmd0aCA6IHRoaXMuaGlkZGVuTmV1cm9ucy5sZW5ndGgpO1xyXG4gICAgdmFyIHdlaWdodCA9IHRoaXMuc2NhbGVXZWlnaHQoc2xpY2UoY2hyb21vc29tZSwgMCwgMTkpLCAtNCwgNCwgMCwgMTA0ODU3NSk7XHJcblxyXG4gICAgdmFyIHNvdXJjZTtcclxuICAgIHZhciBzaW5rO1xyXG5cclxuICAgIGlmIChzb3VyY2VJc0FuSW5wdXROZXVyb24pIHtcclxuICAgICAgLy8gZ2V0IHRoZSBzZW5zb3IgdHlwZVxyXG4gICAgICBzb3VyY2UgPSB0aGlzLmlucHV0TmV1cm9uc1tnZXRTb3VyY2VJbnN0YW5jZV07XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAvLyB0aGlzIGlzIGEgaGlkZGVuIGxheWVyIG5ldXJvblxyXG4gICAgICBzb3VyY2UgPSB0aGlzLmhpZGRlbk5ldXJvbnNbZ2V0U291cmNlSW5zdGFuY2VdO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChzaW5rSXNBbk91dHB1dE5ldXJvbikge1xyXG4gICAgICAvLyBnZXQgdGhlIGFjdGlvbiB0eXBlXHJcbiAgICAgIHNpbmsgPSB0aGlzLm91dHB1dE5ldXJvbnNbZ2V0T3V0cHV0SW5zdGFuY2VdO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8gdGhpcyBpcyBhIGhpZGRlbiBsYXllciBuZXVyb25cclxuICAgICAgc2luayA9IHRoaXMuaGlkZGVuTmV1cm9uc1tnZXRPdXRwdXRJbnN0YW5jZV07XHJcbiAgICB9XHJcblxyXG4gICAgc2luay5hZGRDb25uZWN0aW9uKG5ldyBDb25uZWN0aW9uKHNvdXJjZSwgc2luaywgd2VpZ2h0KSk7XHJcbiAgfVxyXG5cclxuICBmZWVkRm9yd2FyZChjcmVhdHVyZSkge1xyXG4gICAgLy8gT25seSByZXR1cm4gb3V0cHV0IG5ldXJvbnMgd2l0aCBhIHBvc2l0aXZlIFwicHJvYmFiaWxpdHlcIlxyXG4gICAgcmV0dXJuIHRoaXMub3V0cHV0TmV1cm9ucy5maWx0ZXIoKG4pID0+IHtcclxuICAgICAgdmFyIG91dHB1dEZvck4gPSB0aGlzLmZlZWRGb3J3YXJkUGVyKG4sIGNyZWF0dXJlKTtcclxuICAgICAgbi51cGRhdGVMYXN0VmFsdWUob3V0cHV0Rm9yTik7XHJcbiAgICAgIHJldHVybiBvdXRwdXRGb3JOID4gMDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZmVlZEZvcndhcmRQZXIobmV1cm9uLCBjcmVhdHVyZSkge1xyXG4gICAgdmFyIGRlcHRoID0gMDtcclxuXHJcbiAgICBsZXQgZ2V0SW5wdXQgPSAoY29ubmVjdGlvbiwgc2Vlbk5vZGVzKSA9PiB7XHJcbiAgICAgIGRlcHRoKys7XHJcbiAgICAgIGlmIChkZXB0aCA+IDE1KSB7XHJcbiAgICAgICAgZGVidWdnZXI7XHJcbiAgICAgIH1cclxuICAgICAgLy8gdGhpcyBjb25uZWN0aW9uIGhhcyBhIHNvdXJjZSBhbmQgYSB3ZWlnaHQsIG5lZWQgdG8gZ2V0IHRoZSBzb3VyY2UgaW5wdXQgdmFsdWUgKiB3ZWlnaHQgYW5kIHJldHVybiB0aGF0XHJcbiAgICAgIHZhciBzaW5rID0gY29ubmVjdGlvbi5zaW5rO1xyXG4gICAgICB2YXIgc291cmNlID0gY29ubmVjdGlvbi5zb3VyY2U7XHJcbiAgICAgIHZhciB3ZWlnaHQgPSBjb25uZWN0aW9uLndlaWdodDtcclxuICAgICAgc2Vlbk5vZGVzLnNldChzaW5rLCBzaW5rLmdldFZhbHVlKGNyZWF0dXJlKSk7XHJcblxyXG4gICAgICBpZiAoc2Vlbk5vZGVzLmhhcyhzb3VyY2UpKSB7XHJcbiAgICAgICAgcmV0dXJuIHNlZW5Ob2Rlcy5nZXQoc291cmNlKTtcclxuICAgICAgfSBlbHNlIGlmIChzb3VyY2UuY29ubmVjdGlvbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgLy8gd2UncmUgYXQgdGhlIHRvcCBvZiB0aGUgdHJlZSBzbyByZXR1cm4gdGhlIHZhbHVlIG9mIHRoZSBpbnB1dCAqIHdlaWdodFxyXG4gICAgICAgIHZhciBpbnB1dCA9IHNvdXJjZS5nZXRWYWx1ZShjcmVhdHVyZSk7XHJcbiAgICAgICAgcmV0dXJuIGlucHV0ICogd2VpZ2h0O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIHdlIHN0aWxsIGhhdmUgbW9yZSBjb25uZWN0aW9ucyB0byBnZXRcclxuICAgICAgICB2YXIgc3VtT2ZXZWlnaHRlZElucHV0cyA9IDA7XHJcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHNvdXJjZS5jb25uZWN0aW9ucy5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBzb3VyY2UuY29ubmVjdGlvbnNbaW5kZXhdO1xyXG4gICAgICAgICAgc3VtT2ZXZWlnaHRlZElucHV0cyArPSBnZXRJbnB1dChjb25uZWN0aW9uLCBzZWVuTm9kZXMpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIE1hdGgudGFuaChzdW1PZldlaWdodGVkSW5wdXRzKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgc3VtT2ZXZWlnaHRlZElucHV0cyA9IDA7XHJcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgbmV1cm9uLmNvbm5lY3Rpb25zLmxlbmd0aDsgaW5kZXgrKykge1xyXG4gICAgICBjb25zdCBzZWVuTm9kZXMgPSBuZXcgTWFwKCk7XHJcbiAgICAgIGNvbnN0IGNvbm5lY3Rpb24gPSBuZXVyb24uY29ubmVjdGlvbnNbaW5kZXhdO1xyXG4gICAgICBzdW1PZldlaWdodGVkSW5wdXRzICs9IGdldElucHV0KGNvbm5lY3Rpb24sIHNlZW5Ob2Rlcyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gTWF0aC50YW5oKHN1bU9mV2VpZ2h0ZWRJbnB1dHMpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgQ3JlYXR1cmUgZnJvbSBcIi4vY3JlYXR1cmUuanNcIjtcclxuaW1wb3J0IEdhbWUgZnJvbSBcIi4vZ2FtZS5qc1wiO1xyXG5pbXBvcnQgR2Vub21lIGZyb20gXCIuL2dlbm9tZS5qc1wiO1xyXG5pbXBvcnQgU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvRWFzdCBmcm9tIFwiLi9ubi9pbnB1dHMvU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvRWFzdFwiO1xyXG5pbXBvcnQgU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvV2VzdCBmcm9tIFwiLi9ubi9pbnB1dHMvU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvV2VzdFwiO1xyXG5pbXBvcnQgU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvU291dGggZnJvbSBcIi4vbm4vaW5wdXRzL1NlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb1NvdXRoXCI7XHJcbmltcG9ydCBTZW5zaXRpdml0eVRvUHJveGltaXR5VG9Ob3J0aCBmcm9tIFwiLi9ubi9pbnB1dHMvU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvTm9ydGhcIjtcclxuaW1wb3J0IE5ldXJhbE5ldHdvcmsgZnJvbSBcIi4vbm4vbmV1cmFsLW5ldHdvcmsuanNcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNpbXVsYXRpb24ge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgc2l6ZU9mUG9wdWxhdGlvbixcclxuICAgIG51bWJlck9mR2VuZXJhdGlvbnNUb1J1bixcclxuICAgIG1vdmVzUGVyR2VuZXJhdGlvbixcclxuICAgIGZyYW1lc1BlclNlY29uZCxcclxuICAgIHNpemVPZkdlbm9tZSxcclxuICAgIG51bWJlck9mTmV1cm9uc0luSGlkZGVuTGF5ZXIsXHJcbiAgICBtdXRhdGlvblJhdGUsXHJcbiAgICBzdWNjZXNzQ3JpdGVyaWFWaXN1YWxpemF0aW9uXHJcbiAgKSB7XHJcbiAgICB0aGlzLnNpemVPZlBvcHVsYXRpb24gPSBzaXplT2ZQb3B1bGF0aW9uO1xyXG4gICAgdGhpcy5udW1iZXJPZkdlbmVyYXRpb25zVG9SdW4gPSBudW1iZXJPZkdlbmVyYXRpb25zVG9SdW47XHJcbiAgICB0aGlzLm1vdmVzUGVyR2VuZXJhdGlvbiA9IG1vdmVzUGVyR2VuZXJhdGlvbjtcclxuICAgIHRoaXMuZnJhbWVzUGVyU2Vjb25kID0gZnJhbWVzUGVyU2Vjb25kO1xyXG4gICAgdGhpcy5zaXplT2ZHZW5vbWUgPSBzaXplT2ZHZW5vbWU7XHJcbiAgICB0aGlzLm51bWJlck9mTmV1cm9uc0luSGlkZGVuTGF5ZXIgPSBudW1iZXJPZk5ldXJvbnNJbkhpZGRlbkxheWVyO1xyXG4gICAgdGhpcy5tdXRhdGlvblJhdGUgPSBtdXRhdGlvblJhdGU7XHJcbiAgICB0aGlzLnN1Y2Nlc3NDcml0ZXJpYVZpc3VhbGl6YXRpb24gPSBzdWNjZXNzQ3JpdGVyaWFWaXN1YWxpemF0aW9uO1xyXG5cclxuICAgIHRoaXMuX3NlbnNpdGl2aXR5TmV1cm9uRmFjdG9yeSA9IChnYW1lKSA9PiAodHlwZSkgPT4ge1xyXG4gICAgICBzd2l0Y2ggKHR5cGUpIHtcclxuICAgICAgICBjYXNlIFwiU2Vuc2l0aXZpdHlUb1Byb3hpbWl0eVRvRWFzdFwiOlxyXG4gICAgICAgICAgcmV0dXJuIG5ldyBTZW5zaXRpdml0eVRvUHJveGltaXR5VG9FYXN0KGdhbWUpO1xyXG4gICAgICAgIGNhc2UgXCJTZW5zaXRpdml0eVRvUHJveGltaXR5VG9XZXN0XCI6XHJcbiAgICAgICAgICByZXR1cm4gbmV3IFNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb1dlc3QoZ2FtZSk7XHJcbiAgICAgICAgY2FzZSBcIlNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb1NvdXRoXCI6XHJcbiAgICAgICAgICByZXR1cm4gbmV3IFNlbnNpdGl2aXR5VG9Qcm94aW1pdHlUb1NvdXRoKGdhbWUpO1xyXG4gICAgICAgIGNhc2UgXCJTZW5zaXRpdml0eVRvUHJveGltaXR5VG9Ob3J0aFwiOlxyXG4gICAgICAgICAgcmV0dXJuIG5ldyBTZW5zaXRpdml0eVRvUHJveGltaXR5VG9Ob3J0aChnYW1lKTtcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgdGhpcy5jdXJyZW50U3RlcENvdW50ID0gMDtcclxuICAgIHRoaXMuY3VycmVudEdlbmVyYXRpb25Db3VudCA9IDA7XHJcbiAgICB0aGlzLmdlbmVyYXRpb25Db3VudExhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImgxXCIpO1xyXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmdlbmVyYXRpb25Db3VudExhYmVsKTtcclxuICAgIHRoaXMuc3RlcENvdW50TGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaDFcIik7XHJcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuc3RlcENvdW50TGFiZWwpO1xyXG4gIH1cclxuXHJcbiAgX3JhbmRvbU51bWJlckJldHdlZW4obWluLCBtYXgpIHtcclxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluKSArIDEpO1xyXG4gIH1cclxuXHJcbiAgX3JvdW5kVG9OZWFyZXN0KG51bWJlclRvUm91bmQsIHZhbHVlVG9OZWFyZXN0KSB7XHJcbiAgICByZXR1cm4gTWF0aC5jZWlsKG51bWJlclRvUm91bmQgLyB2YWx1ZVRvTmVhcmVzdCkgKiB2YWx1ZVRvTmVhcmVzdDtcclxuICB9XHJcblxyXG4gIF9nZXRQb3NpdGlvbldpdGhpbihnYW1lKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fcm91bmRUb05lYXJlc3QodGhpcy5fcmFuZG9tTnVtYmVyQmV0d2VlbigwLCBnYW1lLndpZHRoICogZ2FtZS5kaXZpc2lvblNpemUgLSBnYW1lLmRpdmlzaW9uU2l6ZSksIGdhbWUuZGl2aXNpb25TaXplKTtcclxuICB9XHJcblxyXG4gIF9pbml0aWFsaXNlR2FtZSgpIHtcclxuICAgIHRoaXMuZ2FtZSA9IG5ldyBHYW1lKDEyOCwgMTI4LCA1LCBmYWxzZSwgdGhpcy5zdWNjZXNzQ3JpdGVyaWFWaXN1YWxpemF0aW9uKTtcclxuICB9XHJcblxyXG4gIF9nZW5lcmF0ZUluaXRpYWxDb2hvcnQoKSB7XHJcbiAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGhpcy5zaXplT2ZQb3B1bGF0aW9uOyBpbmRleCsrKSB7XHJcbiAgICAgIC8vIDAsMCB0byA2MzUsNjM1XHJcbiAgICAgIGNvbnN0IGdlbm9tZSA9IG5ldyBHZW5vbWUodGhpcy5zaXplT2ZHZW5vbWUpO1xyXG4gICAgICBjb25zdCBuZXVyYWxOZXR3b3JrID0gbmV3IE5ldXJhbE5ldHdvcmsodGhpcy5udW1iZXJPZk5ldXJvbnNJbkhpZGRlbkxheWVyLCBnZW5vbWUsIHRoaXMuX3NlbnNpdGl2aXR5TmV1cm9uRmFjdG9yeSh0aGlzLmdhbWUpKTtcclxuICAgICAgY29uc3QgY3JlYXR1cmUgPSBuZXcgQ3JlYXR1cmUoXHJcbiAgICAgICAgZ2Vub21lLFxyXG4gICAgICAgIG5ldXJhbE5ldHdvcmssXHJcbiAgICAgICAgdGhpcy5fZ2V0UG9zaXRpb25XaXRoaW4odGhpcy5nYW1lKSxcclxuICAgICAgICB0aGlzLl9nZXRQb3NpdGlvbldpdGhpbih0aGlzLmdhbWUpLFxyXG4gICAgICAgIHRoaXMuZ2FtZS5kaXZpc2lvblNpemUsXHJcbiAgICAgICAgdGhpcy5nYW1lLndpZHRoLFxyXG4gICAgICAgIHRoaXMuZ2FtZS5oZWlnaHQsXHJcbiAgICAgICAgMSxcclxuICAgICAgICBmYWxzZVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLmdhbWUuYWRkQ3JlYXR1cmUoY3JlYXR1cmUpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2dlbmVyYXRlTmV4dENvaG9ydChzdXJ2aXZvcnMpIHtcclxuICAgIHRoaXMuZ2FtZS5nYW1lQ3JlYXR1cmVzID0gW107XHJcbiAgICBmb3IgKGxldCBpbmRleE9uZSA9IDAsIGluZGV4VHdvID0gMjsgaW5kZXhUd28gPCBzdXJ2aXZvcnMubGVuZ3RoOyBpbmRleE9uZSsrLCBpbmRleFR3bysrKSB7XHJcbiAgICAgIGNvbnN0IHBhcmVudE9uZSA9IHN1cnZpdm9yc1tpbmRleE9uZV07XHJcbiAgICAgIGNvbnN0IHBhcmVudFR3byA9IHN1cnZpdm9yc1tpbmRleE9uZSArIDFdO1xyXG4gICAgICBjb25zdCBwYXJlbnRPbmVHZW5vbWUgPSBwYXJlbnRPbmUuZ2Vub21lO1xyXG4gICAgICBjb25zdCBwYXJlbnRUd29HZW5vbWUgPSBwYXJlbnRUd28uZ2Vub21lO1xyXG4gICAgICB2YXIgY2hpbGRHZW5vbWVPbmUgPSBHZW5vbWUuY3JlYXRlTmV3R2Vub21lRnJvbVBhcmVudHMocGFyZW50T25lR2Vub21lLCBwYXJlbnRUd29HZW5vbWUpO1xyXG4gICAgICB2YXIgY2hpbGRHZW5vbWVUd28gPSBHZW5vbWUuY3JlYXRlTmV3R2Vub21lRnJvbVBhcmVudHMocGFyZW50VHdvR2Vub21lLCBwYXJlbnRPbmVHZW5vbWUpO1xyXG4gICAgICBjb25zdCBuZXVyYWxOZXR3b3JrT25lID0gbmV3IE5ldXJhbE5ldHdvcmsoXHJcbiAgICAgICAgdGhpcy5udW1iZXJPZk5ldXJvbnNJbkhpZGRlbkxheWVyLFxyXG4gICAgICAgIGNoaWxkR2Vub21lT25lLFxyXG4gICAgICAgIHRoaXMuX3NlbnNpdGl2aXR5TmV1cm9uRmFjdG9yeSh0aGlzLmdhbWUpXHJcbiAgICAgICk7XHJcbiAgICAgIGNvbnN0IG5ldXJhbE5ldHdvcmtUd28gPSBuZXcgTmV1cmFsTmV0d29yayhcclxuICAgICAgICB0aGlzLm51bWJlck9mTmV1cm9uc0luSGlkZGVuTGF5ZXIsXHJcbiAgICAgICAgY2hpbGRHZW5vbWVUd28sXHJcbiAgICAgICAgdGhpcy5fc2Vuc2l0aXZpdHlOZXVyb25GYWN0b3J5KHRoaXMuZ2FtZSlcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGNvbnN0IGNyZWF0dXJlT25lID0gbmV3IENyZWF0dXJlKFxyXG4gICAgICAgIGNoaWxkR2Vub21lT25lLFxyXG4gICAgICAgIG5ldXJhbE5ldHdvcmtPbmUsXHJcbiAgICAgICAgdGhpcy5fZ2V0UG9zaXRpb25XaXRoaW4odGhpcy5nYW1lKSxcclxuICAgICAgICB0aGlzLl9nZXRQb3NpdGlvbldpdGhpbih0aGlzLmdhbWUpLFxyXG4gICAgICAgIHRoaXMuZ2FtZS5kaXZpc2lvblNpemUsXHJcbiAgICAgICAgdGhpcy5nYW1lLndpZHRoLFxyXG4gICAgICAgIHRoaXMuZ2FtZS5oZWlnaHQsXHJcbiAgICAgICAgMSxcclxuICAgICAgICBmYWxzZVxyXG4gICAgICApO1xyXG5cclxuICAgICAgY29uc3QgY3JlYXR1cmVUd28gPSBuZXcgQ3JlYXR1cmUoXHJcbiAgICAgICAgY2hpbGRHZW5vbWVUd28sXHJcbiAgICAgICAgbmV1cmFsTmV0d29ya1R3byxcclxuICAgICAgICB0aGlzLl9nZXRQb3NpdGlvbldpdGhpbih0aGlzLmdhbWUpLFxyXG4gICAgICAgIHRoaXMuX2dldFBvc2l0aW9uV2l0aGluKHRoaXMuZ2FtZSksXHJcbiAgICAgICAgdGhpcy5nYW1lLmRpdmlzaW9uU2l6ZSxcclxuICAgICAgICB0aGlzLmdhbWUud2lkdGgsXHJcbiAgICAgICAgdGhpcy5nYW1lLmhlaWdodCxcclxuICAgICAgICAxLFxyXG4gICAgICAgIGZhbHNlXHJcbiAgICAgICk7XHJcblxyXG4gICAgICB0aGlzLmdhbWUuYWRkQ3JlYXR1cmUoY3JlYXR1cmVPbmUpO1xyXG4gICAgICB0aGlzLmdhbWUuYWRkQ3JlYXR1cmUoY3JlYXR1cmVUd28pO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2FuaW1hdGUoKSB7XHJcbiAgICB0aGlzLnN0ZXBDb3VudExhYmVsLmlubmVyVGV4dCA9IGBHZW5lcmF0aW9uIFN0ZXAgQ291bnQ6ICR7dGhpcy5jdXJyZW50U3RlcENvdW50Kyt9YDtcclxuICAgIHRoaXMuZ2FtZS51cGRhdGUoKTtcclxuICAgIGlmICh0aGlzLmN1cnJlbnRTdGVwQ291bnQgPD0gdGhpcy5tb3Zlc1BlckdlbmVyYXRpb24pIHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5fYW5pbWF0ZS5iaW5kKHRoaXMpKSwgMTAwMCAvIHRoaXMuZnJhbWVzUGVyU2Vjb25kKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIC8vIFRoaXMgZ2VuZXJhdGlvbiBoYXMgZmluaXNoZWQsIHRpbWUgdG8gZ2V0IHRoZSBzdXJ2aXZvcnMgdG8gcmVwcm9kdWNlXHJcbiAgICAgIC8vIFRoZW4gc2V0IHRoZSBib2FyZCBiYWNrIHdpdGggdGhlIG5ldyBnZW5lcmF0aW9uXHJcbiAgICAgIHRoaXMuZ2VuZXJhdGlvbkNvdW50TGFiZWwuaW5uZXJUZXh0ID0gYEdlbiAkeysrdGhpcy5jdXJyZW50R2VuZXJhdGlvbkNvdW50fWA7XHJcbiAgICAgIGNvbnN0IHN1cnZpdm9ycyA9IHRoaXMuZ2FtZS5nZXRTdXJ2aXZvcnModGhpcy5zdWNjZXNzQ3JpdGVyaWFWaXN1YWxpemF0aW9uLnN1Y2Nlc3NDcml0ZXJpYSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKGBOdW1iZXIgb2Ygc3Vydml2b3JzICR7c3Vydml2b3JzLmxlbmd0aH0uYCk7XHJcbiAgICAgIHRoaXMuX2dlbmVyYXRlTmV4dENvaG9ydChzdXJ2aXZvcnMpO1xyXG4gICAgICB0aGlzLmN1cnJlbnRTdGVwQ291bnQgPSAwO1xyXG4gICAgICB0aGlzLl9hbmltYXRlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzdGFydCgpIHtcclxuICAgIHRoaXMuZ2VuZXJhdGlvbkNvdW50TGFiZWwuaW5uZXJUZXh0ID0gYEdlbiAke3RoaXMuY3VycmVudEdlbmVyYXRpb25Db3VudH1gO1xyXG4gICAgdGhpcy5faW5pdGlhbGlzZUdhbWUoKTtcclxuICAgIHRoaXMuX2dlbmVyYXRlSW5pdGlhbENvaG9ydCgpO1xyXG4gICAgdGhpcy5fYW5pbWF0ZSgpO1xyXG4gIH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///3\n')}]);